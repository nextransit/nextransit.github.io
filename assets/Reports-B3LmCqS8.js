import{J as H,K as q,M as Q,N as Z,O as ee,P as se,Q as te,T as ae,U as re,u as ie,j as e,L as N,m as x,q as w,V as T,W as le,Y as ne,d as de,X as C,r as oe}from"./index-D2lxm7TE.js";import{r as S}from"./vendor-xASHc04L.js";import{u as ce,a as xe,o as me,s as b,_ as D}from"./schemas-oLtz9YBc.js";import{u as pe}from"./i18n-Skc9GWxP.js";import{P as he}from"./plus-BwHWfSI_.js";import{T as je}from"./trending-down-CTKi4ifQ.js";import{R as L,B as ue,C as ye,X as Ne,Y as E,T as I,d as P,P as be,b as ge,c as fe}from"./charts-X6rqVOAO.js";import{F as M}from"./file-text-cYS94zge.js";import{D as ve}from"./download-DlFlLBXU.js";import"./ui-BMjqw1mu.js";const ke=me({name:b().min(1),type:D(["TRANSACTION_SUMMARY","TRANSACTION_DETAIL","REVENUE_ANALYSIS","CARD_USAGE","TERMINAL_PERFORMANCE","ROUTE_ANALYTICS","CUSTOM"]),format:D(["PDF","EXCEL","CSV","JSON"]),startDate:b().optional(),endDate:b().optional()}),Re={OPERATIONAL:"badge-info",FINANCIAL:"badge-success",SECURITY:"badge-error",ANALYTICS:"badge-warning"};function _e(){const{t:s}=pe(),[g,F]=S.useState("7d"),[U,m]=S.useState(!1),{data:f,isLoading:O}=H(),{data:_,isLoading:Y}=q(),{data:l,isLoading:G}=Q(g),{data:Ae,isLoading:V}=Z(5),{data:we,isLoading:K}=ee(),{data:v,isLoading:X}=se(),j=te(),k=ae(),R=re(),{confirm:z,dialogProps:B}=ie(),i=ce({resolver:xe(ke),defaultValues:{type:"TRANSACTION_SUMMARY",format:"PDF"}}),J=async t=>{try{await j.mutateAsync({...t,parameters:{startDate:t.startDate,endDate:t.endDate}}),m(!1),i.reset()}catch(a){console.error("Failed to create report:",a)}},$=async(t,a)=>{try{const n=await R.mutateAsync(t),o=window.URL.createObjectURL(n),c=document.createElement("a");c.href=o,c.download=a,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(o),document.body.removeChild(c)}catch(n){console.error("Failed to download report:",n)}},W=async t=>{if(await z({type:"danger",title:s("reports.deleteReport"),message:s("reports.confirmDelete"),riskWarning:s("reports.deleteWarning")}))try{await k.mutateAsync(t)}catch(n){console.error("Failed to delete report:",n)}},r={...{totalTransactions:0,totalRevenue:0,activeCards:0,activeTerminals:0,averageTransactionAmount:0,successRate:0,todayTransactions:0,todayRevenue:0,yesterdayTransactions:0,yesterdayRevenue:0,transactionGrowth:0,revenueGrowth:0},..._||{}},d=t=>{const a=Number(t);return isNaN(a)?0:a},u={labels:Array.isArray(l==null?void 0:l.labels)?l.labels:[],datasets:Array.isArray(l==null?void 0:l.datasets)?l.datasets:[]},y=Array.isArray(v)?v:[],A=Array.isArray(f)?f:[];if(Y||G||V||K||X)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-primary-600"})});const p=r.yesterdayRevenue>0?(r.todayRevenue-r.yesterdayRevenue)/r.yesterdayRevenue*100:0,h=r.yesterdayTransactions>0?(r.todayTransactions-r.yesterdayTransactions)/r.yesterdayTransactions*100:0;return e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:s("reports.title")}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:s("reports.subtitle")})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:()=>m(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),s("reports.createReport")]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:s("reports.totalRevenue")}),e.jsxs("p",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100 mt-1",children:["¥",d(r.totalRevenue).toLocaleString()]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[p>=0?e.jsx(w,{className:"w-4 h-4 text-success"}):e.jsx(T,{className:"w-4 h-4 text-error"}),e.jsxs("span",{className:`text-sm ${p>=0?"text-success":"text-error"}`,children:[p>0?"+":"",d(p).toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-slate-500",children:s("reports.vsYesterday")})]})]}),e.jsx("div",{className:"p-3 rounded-xl bg-primary-500/10",children:e.jsx(le,{className:"w-6 h-6 text-primary-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:s("reports.totalTransactions")}),e.jsx("p",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100 mt-1",children:d(r.totalTransactions).toLocaleString()}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[h>=0?e.jsx(w,{className:"w-4 h-4 text-success"}):e.jsx(T,{className:"w-4 h-4 text-error"}),e.jsxs("span",{className:`text-sm ${h>=0?"text-success":"text-error"}`,children:[h>0?"+":"",d(h).toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-slate-500",children:s("reports.vsYesterday")})]})]}),e.jsx("div",{className:"p-3 rounded-xl bg-success/10",children:e.jsx(ne,{className:"w-6 h-6 text-success"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:s("reports.activeCards")}),e.jsx("p",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100 mt-1",children:d(r.activeCards).toLocaleString()})]}),e.jsx("div",{className:"p-3 rounded-xl bg-accent-500/10",children:e.jsx(de,{className:"w-6 h-6 text-accent-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:s("reports.avgTransaction")}),e.jsxs("p",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100 mt-1",children:["¥",d(r.averageTransactionAmount).toFixed(1)]})]}),e.jsx("div",{className:"p-3 rounded-xl bg-warning/10",children:e.jsx(je,{className:"w-6 h-6 text-warning"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass-panel p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-display font-semibold text-slate-900 dark:text-slate-100",children:s("reports.revenueAndTransactions")}),e.jsxs("select",{value:g,onChange:t=>F(t.target.value),className:"px-3 py-1 text-sm border border-slate-200 dark:border-dark-600 rounded-lg bg-slate-50 dark:bg-dark-900",children:[e.jsx("option",{value:"7d",children:s("reports.last7Days")}),e.jsx("option",{value:"30d",children:s("reports.last30Days")}),e.jsx("option",{value:"90d",children:s("reports.last90Days")})]})]}),e.jsx("div",{className:"h-80",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(ue,{data:u.labels.map((t,a)=>{var n,o;return{name:t,revenue:((n=u.datasets[0])==null?void 0:n.data[a])||0,transactions:((o=u.datasets[1])==null?void 0:o.data[a])||0}}),children:[e.jsx(ye,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-dark-600"}),e.jsx(Ne,{dataKey:"name",stroke:"#64748b",fontSize:12}),e.jsx(E,{yAxisId:"left",stroke:"#64748b",fontSize:12}),e.jsx(E,{yAxisId:"right",orientation:"right",stroke:"#64748b",fontSize:12}),e.jsx(I,{contentStyle:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",borderRadius:"8px"}}),e.jsx(P,{yAxisId:"left",dataKey:"revenue",fill:"#06b6d4",radius:[4,4,0,0]}),e.jsx(P,{yAxisId:"right",dataKey:"transactions",fill:"#10b981",radius:[4,4,0,0]})]})})})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"glass-panel p-6",children:[e.jsx("h2",{className:"text-lg font-display font-semibold text-slate-900 dark:text-slate-100 mb-6",children:s("reports.cardTypeDistribution")}),e.jsxs("div",{className:"h-80 flex items-center",children:[e.jsx(L,{width:"60%",height:"100%",children:e.jsxs(be,{children:[e.jsx(ge,{data:y,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"count",nameKey:"type",children:y.map((t,a)=>e.jsx(fe,{fill:["#06b6d4","#10b981","#f59e0b","#a855f7"][a%4]},`cell-${a}`))}),e.jsx(I,{})]})}),e.jsx("div",{className:"space-y-3 flex-1",children:y.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:["#06b6d4","#10b981","#f59e0b","#a855f7"][a%4]}}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:t.type}),e.jsxs("span",{className:"text-sm text-slate-500",children:["(",d(t.percentage).toFixed(1),"%)"]})]},t.type))})]})]})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"glass-panel",children:[e.jsx("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-dark-600",children:e.jsx("h2",{className:"text-lg font-display font-semibold text-slate-900 dark:text-slate-100",children:s("reports.generatedReports")})}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-dark-600",children:O?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(N,{className:"w-6 h-6 animate-spin text-primary-600"})}):A.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:s("reports.noReports")})]}):A.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-50 dark:hover:bg-dark-700/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-slate-100 dark:bg-dark-700",children:e.jsx(M,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-slate-900 dark:text-slate-200",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-500",children:[s("reports.generated"),": ",new Date(t.createdAt).toLocaleString()," • ",t.format]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`badge ${Re[t.type]||"badge-info"}`,children:t.type}),e.jsx("button",{onClick:()=>$(t.id,t.name),disabled:R.isPending,className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(ve,{className:"w-4 h-4 text-slate-400"})}),e.jsx("button",{onClick:()=>W(t.id),disabled:k.isPending,className:"p-2 hover:bg-error/10 text-error rounded-lg transition-colors disabled:opacity-50",children:e.jsx(C,{className:"w-4 h-4"})})]})]},t.id))})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(x.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"glass-panel w-full max-w-lg p-6 bg-white dark:bg-dark-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-display font-bold text-slate-900 dark:text-slate-100",children:s("reports.createReport")}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg",children:e.jsx(C,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:i.handleSubmit(J),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:s("reports.reportName")}),e.jsx("input",{...i.register("name"),className:"input-field"}),i.formState.errors.name&&e.jsx("p",{className:"mt-1 text-sm text-error",children:i.formState.errors.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:s("reports.reportType")}),e.jsxs("select",{...i.register("type"),className:"input-field",children:[e.jsx("option",{value:"TRANSACTION_SUMMARY",children:s("reports.typeTransactionSummary")}),e.jsx("option",{value:"TRANSACTION_DETAIL",children:s("reports.typeTransactionDetail")}),e.jsx("option",{value:"REVENUE_ANALYSIS",children:s("reports.typeRevenueAnalysis")}),e.jsx("option",{value:"CARD_USAGE",children:s("reports.typeCardUsage")}),e.jsx("option",{value:"TERMINAL_PERFORMANCE",children:s("reports.typeTerminalPerformance")}),e.jsx("option",{value:"ROUTE_ANALYTICS",children:s("reports.typeRouteAnalytics")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:s("reports.reportFormat")}),e.jsxs("select",{...i.register("format"),className:"input-field",children:[e.jsx("option",{value:"PDF",children:"PDF"}),e.jsx("option",{value:"EXCEL",children:"Excel"}),e.jsx("option",{value:"CSV",children:"CSV"}),e.jsx("option",{value:"JSON",children:"JSON"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:s("reports.startDate")}),e.jsx("input",{type:"date",...i.register("startDate"),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:s("reports.endDate")}),e.jsx("input",{type:"date",...i.register("endDate"),className:"input-field"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 btn-secondary",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:i.formState.isSubmitting||j.isPending,className:"flex-1 btn-primary flex items-center justify-center gap-2 disabled:opacity-50",children:[(i.formState.isSubmitting||j.isPending)&&e.jsx(N,{className:"w-4 h-4 animate-spin"}),s("reports.generate")]})]})]})]})}),e.jsx(oe,{...B})]})}export{_e as default};
