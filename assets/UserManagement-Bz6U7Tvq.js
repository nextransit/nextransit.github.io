import{c as N,a9 as u,j as e,A as U,m as g,n as Y,b as ee,R as te,a as P,p as ae,X as R,aw as se,ax as re,L as q}from"./index-BFkHSXE8.js";import{r as o}from"./vendor-xASHc04L.js";import{u as le}from"./i18n-Skc9GWxP.js";import{C as D}from"./check-CaHv72ax.js";import{T as de}from"./trash-2-Dn5u56zO.js";import"./ui-BMjqw1mu.js";import"./charts-X6rqVOAO.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=N("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=N("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=N("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=N("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),S=[{value:"super_admin",label:"Super Admin",color:"bg-purple-100 text-purple-800"},{value:"admin",label:"Admin",color:"bg-blue-100 text-blue-800"},{value:"project_admin",label:"Project Admin",color:"bg-green-100 text-green-800"},{value:"operator",label:"Operator",color:"bg-yellow-100 text-yellow-800"},{value:"viewer",label:"Viewer",color:"bg-gray-100 text-gray-800"}],xe={active:"bg-green-100 text-green-800",inactive:"bg-gray-100 text-gray-800",suspended:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800"};function fe(){const{t:a}=le(),[$,E]=o.useState([]),[v,l]=o.useState(!1),[I,n]=o.useState(null),[L,m]=o.useState(null),[k,F]=o.useState(""),[_,b]=o.useState(!1),[O,y]=o.useState(!1),[M,A]=o.useState(null),[i,p]=o.useState({email:"",username:"",displayName:"",password:"",role:"operator",projectId:""}),[c,f]=o.useState({displayName:"",role:"operator",status:"active",projectId:""});o.useEffect(()=>{x()},[]);const x=async()=>{var t,r;l(!0);try{const s=await u.get("/auth/users");E(s.data.users||[])}catch(s){n(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to fetch users")}finally{l(!1)}},T=async t=>{var r,s;t.preventDefault(),l(!0),n(null);try{await u.post("/auth/users",i),m("User created successfully"),b(!1),p({email:"",username:"",displayName:"",password:"",role:"operator",projectId:""}),x()}catch(d){n(((s=(r=d.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to create user")}finally{l(!1)}},H=async t=>{var r,s;if(t.preventDefault(),!!M){l(!0),n(null);try{await u.patch(`/auth/users/${M.userId}`,c),m("User updated successfully"),y(!1),A(null),x()}catch(d){n(((s=(r=d.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to update user")}finally{l(!1)}}},z=async t=>{var r,s;if(confirm(a("userManagement.confirmDelete"))){l(!0);try{await u.delete(`/auth/users/${t}`),m("User deleted successfully"),x()}catch(d){n(((s=(r=d.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to delete user")}finally{l(!1)}}},Q=async t=>{var s,d;const r=prompt(a("userManagement.confirmReset"));if(r){l(!0);try{await u.post(`/auth/users/${t}/reset-password`,{newPassword:r}),m("Password reset successfully")}catch(h){n(((d=(s=h.response)==null?void 0:s.data)==null?void 0:d.message)||"Failed to reset password")}finally{l(!1)}}},V=async t=>{var r,s;l(!0);try{await u.post(`/auth/users/${t}/suspend`),m("User suspended successfully"),x()}catch(d){n(((s=(r=d.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to suspend user")}finally{l(!1)}},X=async t=>{var r,s;l(!0);try{await u.post(`/auth/users/${t}/activate`),m("User activated successfully"),x()}catch(d){n(((s=(r=d.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to activate user")}finally{l(!1)}},Z=async(t,r)=>{var j,w;const s=["demo","viewer","operator","project_admin","admin","super_admin"],d=s.indexOf(r);if(d>=s.length-1){n("User is already at the highest role");return}const h=s[d+1];if(confirm(a("userManagement.confirmUpgrade",{newRole:h}))){l(!0);try{await u.post("/auth/oauth/upgrade-user",{userId:t,newRole:h}),m(a("userManagement.upgradeSuccess")),x()}catch(C){n(((w=(j=C.response)==null?void 0:j.data)==null?void 0:w.message)||"Failed to upgrade user")}finally{l(!1)}}},B=async(t,r)=>{var j,w;const s=["demo","viewer","operator","project_admin","admin","super_admin"],d=s.indexOf(r);if(d<=0){n("User is already at the lowest role");return}const h=s[d-1];if(confirm(a("userManagement.confirmDowngrade",{newRole:h}))){l(!0);try{await u.post("/auth/oauth/downgrade-user",{userId:t,newRole:h}),m(a("userManagement.downgradeSuccess")),x()}catch(C){n(((w=(j=C.response)==null?void 0:j.data)==null?void 0:w.message)||"Failed to downgrade user")}finally{l(!1)}}},G=t=>{A(t),f({displayName:t.displayName,role:t.role,status:t.status,projectId:t.projectId||""}),y(!0)},J=$.filter(t=>t.email.toLowerCase().includes(k.toLowerCase())||t.username.toLowerCase().includes(k.toLowerCase())||t.displayName.toLowerCase().includes(k.toLowerCase())),K=t=>a(`userManagement.roles.${t}`)||t,W=t=>{var r;return((r=S.find(s=>s.value===t))==null?void 0:r.color)||"bg-gray-100 text-gray-800"};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-2",children:a("userManagement.title")}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:a("userManagement.subtitle")})]}),e.jsxs(U,{children:[I&&e.jsxs(g.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-red-600 dark:text-red-400"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:I})]}),L&&e.jsxs(g.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:L})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",value:k,onChange:t=>F(t.target.value),placeholder:a("userManagement.search"),className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:[e.jsx(te,{className:"w-4 h-4"}),a("common.refresh")]}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:[e.jsx(ce,{className:"w-4 h-4"}),a("userManagement.addUser")]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:a("userManagement.user")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:a("userManagement.role")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:a("userManagement.status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:a("userManagement.lastLogin")}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:a("userManagement.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:J.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:t.displayName.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:t.displayName}),e.jsx("p",{className:"text-sm text-slate-500",children:t.email})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${W(t.role)}`,children:K(t.role)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${xe[t.status]||"bg-gray-100 text-gray-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:t.lastLoginAt?new Date(t.lastLoginAt).toLocaleDateString():a("common.never")}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Q(t.userId),className:"p-2 text-slate-400 hover:text-blue-600 dark:hover:text-blue-400",title:"Reset Password",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Z(t.userId,t.role),className:"p-2 text-slate-400 hover:text-green-600 dark:hover:text-green-400",title:a("userManagement.upgradeUser"),children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(t.userId,t.role),className:"p-2 text-slate-400 hover:text-orange-600 dark:hover:text-orange-400",title:a("userManagement.downgradeUser"),children:e.jsx(ne,{className:"w-4 h-4"})}),t.status==="active"?e.jsx("button",{onClick:()=>V(t.userId),className:"p-2 text-slate-400 hover:text-yellow-600 dark:hover:text-yellow-400",title:a("userManagement.suspendUser"),children:e.jsx(ae,{className:"w-4 h-4"})}):e.jsx("button",{onClick:()=>X(t.userId),className:"p-2 text-slate-400 hover:text-green-600 dark:hover:text-green-400",title:a("userManagement.activateUser"),children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(t),className:"p-2 text-slate-400 hover:text-blue-600 dark:hover:text-blue-400",title:a("userManagement.editUser"),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(t.userId),className:"p-2 text-slate-400 hover:text-red-600 dark:hover:text-red-400",title:a("userManagement.deleteUser"),children:e.jsx(de,{className:"w-4 h-4"})})]})})]},t.userId))})]})}),e.jsx(U,{children:_&&e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>b(!1),children:e.jsxs(g.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-md w-full p-6",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:a("userManagement.createUser")}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 text-slate-400 hover:text-slate-600",children:e.jsx(R,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.email")}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"email",value:i.email,onChange:t=>p({...i,email:t.target.value}),className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",required:!0})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",value:i.username,onChange:t=>p({...i,username:t.target.value}),className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:a("userManagement.placeholders.username"),required:!0})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.displayName")}),e.jsx("input",{type:"text",value:i.displayName,onChange:t=>p({...i,displayName:t.target.value}),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:a("userManagement.placeholders.displayName"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.newPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"password",value:i.password,onChange:t=>p({...i,password:t.target.value}),className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:a("userManagement.placeholders.password"),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.role")}),e.jsx("select",{value:i.role,onChange:t=>p({...i,role:t.target.value}),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",children:S.map(t=>e.jsx("option",{value:t.value,children:a(`userManagement.roles.${t.value}`)},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.projectId")}),e.jsx("input",{type:"text",value:i.projectId,onChange:t=>p({...i,projectId:t.target.value}),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:a("userManagement.placeholders.projectId")})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:a("common.cancel")}),e.jsx("button",{type:"submit",disabled:v,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-medium",children:v?e.jsx(q,{className:"w-5 h-5 animate-spin mx-auto"}):a("userManagement.createUser")})]})]})]})})}),e.jsx(U,{children:O&&M&&e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>y(!1),children:e.jsxs(g.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-md w-full p-6",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:a("userManagement.editUser")}),e.jsx("button",{onClick:()=>y(!1),className:"p-2 text-slate-400 hover:text-slate-600",children:e.jsx(R,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.displayName")}),e.jsx("input",{type:"text",value:c.displayName,onChange:t=>f({...c,displayName:t.target.value}),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.role")}),e.jsx("select",{value:c.role,onChange:t=>f({...c,role:t.target.value}),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",children:S.map(t=>e.jsx("option",{value:t.value,children:a(`userManagement.roles.${t.value}`)},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.status")}),e.jsxs("select",{value:c.status,onChange:t=>f({...c,status:t.target.value}),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",children:[e.jsx("option",{value:"active",children:a("userManagement.statuses.active")}),e.jsx("option",{value:"inactive",children:a("userManagement.statuses.inactive")}),e.jsx("option",{value:"suspended",children:a("userManagement.statuses.suspended")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:a("userManagement.projectId")}),e.jsx("input",{type:"text",value:c.projectId,onChange:t=>f({...c,projectId:t.target.value}),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:a("userManagement.placeholders.projectId")})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:a("common.cancel")}),e.jsx("button",{type:"submit",disabled:v,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-medium",children:v?e.jsx(q,{className:"w-5 h-5 animate-spin mx-auto"}):a("userManagement.editUser")})]})]})]})})})]})}export{fe as default};
