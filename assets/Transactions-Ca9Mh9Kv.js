import{c as je,f as $e,s as He,t as Ge,v as Oe,w as Ue,x as ze,y as Ve,j as e,L as qe,n as R,z as I,m as p,B as Be,D as re,R as le,e as ne,q as We,b as Qe,p as U,F as z,G as ie,E as _e,H as Je,C as Xe,A as ce,X as oe,I as de,d as Ke}from"./index-DMlEfpjA.js";import{r as n}from"./vendor-xASHc04L.js";import{u as Ye}from"./i18n-Skc9GWxP.js";import{f as o,s as xe}from"./index-wC2mo2mS.js";import{F as me}from"./filter-D0DADIxg.js";import{C as Ze}from"./calendar-BvudR3TE.js";import{C as pe,S as he,W as ue}from"./wallet-CKk05kMR.js";import{C as M}from"./check-CP4P0shG.js";import{C as be}from"./copy-DRuV41UO.js";import{M as es}from"./more-horizontal-DidaheFx.js";import{P as ss}from"./printer-BL2aE6-S.js";import{M as ge}from"./map-pin-BaZnyJt3.js";import{F as ts}from"./file-text-B2Aj1i4F.js";import{D as as}from"./download-BFHF2iHP.js";import"./ui-BMjqw1mu.js";import"./charts-X6rqVOAO.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=je("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=je("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),ls=["All Types","PURCHASE","RECHARGE","REFUND","TRANSFER","ADJUSTMENT"],ns=["All Status","COMPLETED","PENDING","PROCESSING","FAILED","CANCELLED"];function ws(){var ae;const{t}=Ye(),{trackAction:y}=$e(),[g,Ne]=n.useState("All Types");n.useEffect(()=>{y({type:"view_page",page:"/transactions",timestamp:Date.now()})},[y]);const[T,j]=n.useState("All Status"),[q,P]=n.useState(""),[k,L]=n.useState(1),[c,v]=n.useState({startDate:o(xe(new Date,7),"yyyy-MM-dd"),endDate:o(new Date,"yyyy-MM-dd")}),[B,w]=n.useState(null),[r,W]=n.useState(null),[fe,C]=n.useState(!1),[ye,N]=n.useState(!1),[E,Q]=n.useState("CSV"),[f,F]=n.useState(["id","cardId","type","amount","status","timestamp"]),[_,ke]=n.useState(10),[u,S]=n.useState([]),[ve,J]=n.useState(null),[X,we]=n.useState(null),[$]=n.useState([{id:"1",terminalId:"TERM-102",message:"失败率异常升高 (15%)",severity:"warning"}]),A={type:g==="All Types"?void 0:g,status:T==="All Status"?void 0:T,search:q||void 0,page:k,limit:_,startDate:c.startDate,endDate:c.endDate},{data:i,isLoading:Ce,isError:Ee,error:K,refetch:Y}=He(A),{data:Se}=Ge(c.startDate,c.endDate),{data:Z}=Oe("OPEN",{retry:!1,enabled:!1}),Ae=Ue(),De=ze(),Re=Ve(),ee=async()=>{var s,a;try{const l=await Ae.mutateAsync(A),x=window.URL.createObjectURL(l),m=document.createElement("a");m.href=x,m.download=`transactions_${o(new Date,"yyyy-MM-dd")}.csv`,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(x),document.body.removeChild(m)}catch(l){w(((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||t("transactions.exportError"))}},Ie=async s=>{var a,l;try{await De.mutateAsync(s)}catch(x){w(((l=(a=x.response)==null?void 0:a.data)==null?void 0:l.message)||t("transactions.acknowledgeError"))}},Me=async s=>{var l,x;const a=window.prompt(t("transactions.enterResolution"));if(a)try{await Re.mutateAsync({anomalyId:s,resolution:a})}catch(m){w(((x=(l=m.response)==null?void 0:l.data)==null?void 0:x.message)||t("transactions.resolveError"))}},se=async s=>{try{await navigator.clipboard.writeText(s),J(s),setTimeout(()=>J(null),2e3)}catch(a){console.error("Failed to copy:",a)}},Te=s=>s.length<=14?s:`${s.slice(0,8)}...${s.slice(-6)}`,Pe=()=>{u.length===b.length?S([]):S(b.map(s=>s.id))},Le=s=>{S(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s])},te=s=>Math.abs(s)>100,H=s=>s?s.startsWith("8800")?{icon:e.jsx(ie,{className:"w-3.5 h-3.5"}),label:"Transit",color:"text-primary-500"}:s.startsWith("4")||s.startsWith("5")?{icon:e.jsx(Ke,{className:"w-3.5 h-3.5"}),label:"Bank",color:"text-blue-500"}:{icon:e.jsx(U,{className:"w-3.5 h-3.5"}),label:"Secure",color:"text-accent-500"}:{icon:e.jsx(ue,{className:"w-3.5 h-3.5"}),label:"Standard",color:"text-slate-400"},Fe=s=>{const a=new Date;switch(s){case"peak":v({startDate:o(a,"yyyy-MM-dd"),endDate:o(a,"yyyy-MM-dd")}),P("Peak Hour");break;case"failed24h":j("FAILED"),v({startDate:o(xe(a,1),"yyyy-MM-dd"),endDate:o(a,"yyyy-MM-dd")});break;case"large":P("> 100");break}},b=(i==null?void 0:i.data)||[],d={...{totalTransactions:0,totalAmount:0,successfulTransactions:0,failedTransactions:0,pendingTransactions:0,averageAmount:0,totalRechargeAmount:0,totalPurchaseAmount:0,totalRefundAmount:0},...Se||{}},D=s=>{const a=Number(s);return isNaN(a)?0:a},G=Array.isArray(Z)?Z:[],O=i!=null&&i.total&&A.limit?Math.ceil(i.total/A.limit):1;return Ce?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(qe,{className:"w-8 h-8 animate-spin text-primary-600"})}):Ee?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[e.jsx(R,{className:"w-12 h-12 text-error"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:K instanceof Error?K.message:t("common.loadError")}),e.jsxs("button",{onClick:()=>Y(),className:"btn-secondary flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),t("common.retry")]})]}):e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6","data-help":"transaction-table",children:[B&&e.jsxs("div",{className:"p-4 bg-error/10 border border-error/20 rounded-lg flex items-center gap-3 text-error",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:B}),e.jsx("button",{onClick:()=>w(null),className:"ml-auto text-sm hover:underline",children:t("common.dismiss")})]}),$.length>0&&e.jsxs(p.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl flex items-center gap-4",children:[e.jsx("div",{className:"bg-amber-500/20 p-2 rounded-lg",children:e.jsx(Be,{className:"w-5 h-5 text-amber-500 animate-pulse"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-amber-600 dark:text-amber-400",children:t("transactions.alerts.terminalHealth")}),e.jsx("p",{className:"text-xs text-amber-600/80",children:t("transactions.alerts.message",{terminalId:$[0].terminalId,message:$[0].message})})]}),e.jsx("button",{className:"text-xs font-bold text-amber-600 underline hover:no-underline",children:t("transactions.alerts.viewDetail")})]}),G.length>0&&e.jsxs("div",{className:"p-4 bg-warning/10 border border-warning/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{className:"w-5 h-5 text-warning"}),e.jsx("span",{className:"font-semibold",children:t("transactions.anomaliesDetected",{count:G.length})})]}),e.jsx("div",{className:"space-y-2",children:G.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-dark-800 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.title}),e.jsx("span",{className:"text-sm text-slate-500 ml-2",children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Ie(s.id),className:"px-2 py-1 text-xs rounded bg-slate-100 hover:bg-slate-200",children:t("transactions.acknowledge")}),e.jsx("button",{onClick:()=>Me(s.id),className:"px-2 py-1 text-xs rounded bg-success/10 text-success hover:bg-success/20",children:t("transactions.resolve")})]})]},s.id))})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("transactions.title")}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1 text-sm lg:text-base",children:t("transactions.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-3","data-help":"export-function",children:[e.jsxs("button",{onClick:()=>Y(),className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("transactions.sync")})]}),e.jsxs("button",{onClick:()=>N(!0),className:"btn-primary flex items-center gap-2 text-sm",children:[e.jsx(V,{className:"w-4 h-4"}),t("transactions.exportAction")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"stat-card p-3 lg:p-6 cursor-pointer hover:border-primary-500/50 transition-colors",onClick:()=>j("All Status"),children:[e.jsx("p",{className:"text-xs lg:text-sm text-slate-500 dark:text-slate-400 truncate",children:t("transactions.stats.todayTurnover")}),e.jsxs("p",{className:"text-lg lg:text-2xl font-display font-bold text-slate-900 dark:text-slate-100 mt-1",children:["¥",D(d.totalAmount).toLocaleString()]})]}),e.jsxs("div",{className:"stat-card p-3 lg:p-6 cursor-pointer hover:border-success-500/50 transition-colors",onClick:()=>j("COMPLETED"),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"text-xs lg:text-sm text-slate-500 dark:text-slate-400 truncate",children:t("transactions.stats.settlementRate")}),e.jsxs("span",{className:"text-xs font-medium text-success bg-success/10 px-1.5 py-0.5 rounded",children:[d.totalTransactions>0?Math.round(d.successfulTransactions/d.totalTransactions*100):100,"%"]})]}),e.jsx("p",{className:"text-lg lg:text-2xl font-display font-bold text-success mt-1",children:d.successfulTransactions})]}),e.jsxs("div",{className:"stat-card p-3 lg:p-6 cursor-pointer hover:border-error-500/50 transition-colors",onClick:()=>j("FAILED"),children:[e.jsx("p",{className:"text-xs lg:text-sm text-slate-500 dark:text-slate-400 truncate",children:t("transactions.stats.failedAlert")}),e.jsx("p",{className:"text-lg lg:text-2xl font-display font-bold text-error mt-1",children:d.failedTransactions})]}),e.jsxs("div",{className:"stat-card p-3 lg:p-6",children:[e.jsx("p",{className:"text-xs lg:text-sm text-slate-500 dark:text-slate-400 truncate",children:t("transactions.stats.unprocessed")}),e.jsx("p",{className:"text-lg lg:text-2xl font-display font-bold text-warning mt-1",children:d.pendingTransactions})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2 p-1",children:[e.jsxs("span",{className:"text-secondary text-slate-400 mr-2 flex items-center gap-1.5",children:[e.jsx(me,{className:"w-3.5 h-3.5"}),t("transactions.presets.title")||"Quick Presets",":"]}),[{id:"peak",label:t("transactions.presets.peakHour")||"Peak Hours (7-9)",icon:e.jsx(ne,{className:"w-3.5 h-3.5"})},{id:"failed24h",label:t("transactions.presets.failed24h")||"Last 24h Alerts",icon:e.jsx(re,{className:"w-3.5 h-3.5"})},{id:"large",label:t("transactions.presets.largeAmount")||"High Value (>¥100)",icon:e.jsx(We,{className:"w-3.5 h-3.5"})}].map(s=>e.jsxs("button",{onClick:()=>Fe(s.id),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium bg-white dark:bg-dark-800 text-slate-600 dark:text-slate-300 rounded-full border border-slate-200 dark:border-dark-600 hover:border-primary-500/50 hover:text-primary-500 transition-all shadow-sm",children:[s.icon,s.label]},s.id))]}),e.jsx("div",{className:"glass-panel p-5","data-help":"transaction-filters",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[300px] relative",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 dark:text-slate-500"}),e.jsx("input",{placeholder:t("transactions.searchPlaceholder"),value:q,onChange:s=>P(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-50 dark:bg-dark-900 border border-slate-200 dark:border-dark-600 rounded-lg text-slate-900 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:border-primary-500/50"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-slate-400"}),e.jsx("select",{value:g,onChange:s=>Ne(s.target.value),className:"px-4 py-2 bg-slate-50 dark:bg-dark-900 border border-slate-200 dark:border-dark-600 rounded-lg text-slate-900 dark:text-slate-200 focus:outline-none focus:border-primary-500/50",children:ls.map(s=>e.jsx("option",{value:s,children:t(s==="All Types"?"transactions.allTypes":`transactions.types.${s}`)},s))}),e.jsx("select",{value:T,onChange:s=>j(s.target.value),className:"px-4 py-2 bg-slate-50 dark:bg-dark-900 border border-slate-200 dark:border-dark-600 rounded-lg text-slate-900 dark:text-slate-200 focus:outline-none focus:border-primary-500/50",children:ns.map(s=>e.jsx("option",{value:s,children:t(s==="All Status"?"transactions.allStatus":`transactions.status.${s}`)},s))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 text-slate-400"}),e.jsx("input",{type:"date",value:c.startDate,onChange:s=>v({...c,startDate:s.target.value}),className:"px-3 py-2 bg-slate-50 dark:bg-dark-900 border border-slate-200 dark:border-dark-600 rounded-lg text-slate-900 dark:text-slate-200 focus:outline-none focus:border-primary-500/50"}),e.jsx("span",{className:"text-slate-400",children:"-"}),e.jsx("input",{type:"date",value:c.endDate,onChange:s=>v({...c,endDate:s.target.value}),className:"px-3 py-2 bg-slate-50 dark:bg-dark-900 border border-slate-200 dark:border-dark-600 rounded-lg text-slate-900 dark:text-slate-200 focus:outline-none focus:border-primary-500/50"})]})]})}),e.jsxs("div",{className:"glass-panel overflow-hidden",children:[u.length>0&&e.jsxs("div",{className:"px-4 py-3 bg-primary-50 dark:bg-primary-900/20 border-b border-primary-200 dark:border-primary-800 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-primary-700 dark:text-primary-300",children:t("transactions.batchSelected",{count:u.length})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>ee(),className:"px-3 py-1.5 text-xs font-medium bg-primary-100 dark:bg-primary-800 text-primary-700 dark:text-primary-200 rounded-lg hover:bg-primary-200 dark:hover:bg-primary-700 transition-colors flex items-center gap-1",children:[e.jsx(V,{className:"w-3.5 h-3.5"}),t("transactions.batchExport")]}),e.jsxs("button",{onClick:()=>z(t("common.comingSoon"),t("transactions.markSuspiciousComingSoon")),className:"px-3 py-1.5 text-xs font-medium bg-warning/10 text-warning rounded-lg hover:bg-warning/20 transition-colors flex items-center gap-1",children:[e.jsx(U,{className:"w-3.5 h-3.5"}),t("transactions.markSuspicious")]}),e.jsx("button",{onClick:()=>S([]),className:"px-3 py-1.5 text-xs font-medium text-slate-500 hover:text-slate-700 transition-colors",children:t("common.cancel")})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-dark-600",children:[e.jsx("th",{className:"table-header w-10 text-center",children:e.jsx("button",{onClick:Pe,className:"p-1 hover:bg-slate-100 dark:hover:bg-dark-700 rounded transition-colors",children:u.length===b.length&&b.length>0?e.jsx(pe,{className:"w-4 h-4 text-primary-500"}):e.jsx(he,{className:"w-4 h-4 text-slate-400"})})}),e.jsx("th",{className:"table-header",children:t("transactions.table.transactionId")}),e.jsx("th",{className:"table-header",children:t("transactions.table.cardId")}),e.jsx("th",{className:"table-header",children:t("transactions.table.type")}),e.jsx("th",{className:"table-header",children:t("transactions.table.amount")}),e.jsx("th",{className:"table-header",children:t("transactions.table.terminal")}),e.jsx("th",{className:"table-header",children:t("transactions.table.status")}),e.jsx("th",{className:"table-header",children:t("transactions.table.reconciliation")}),e.jsx("th",{className:"table-header",children:t("transactions.table.timestamp")}),e.jsx("th",{className:"table-header",children:t("transactions.table.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-dark-600",children:b.map((s,a)=>e.jsxs(p.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:`group transition-all duration-200 cursor-pointer border-l-4 ${u.includes(s.id)?"bg-primary-50/50 dark:bg-primary-900/10 border-primary-500":s.status==="FAILED"?"bg-rose-50/30 dark:bg-rose-900/10 border-rose-400 hover:bg-rose-50/50":a%2===0?"bg-slate-50/50 dark:bg-dark-700/20 border-transparent hover:bg-slate-100/50":"bg-white dark:bg-dark-800 border-transparent hover:bg-slate-100/50"}`,onClick:()=>{W(s),C(!0)},children:[e.jsx("td",{className:"px-6 py-6 whitespace-nowrap text-sm text-center",children:e.jsx("button",{onClick:l=>{l.stopPropagation(),Le(s.id)},className:"p-1 hover:bg-slate-100 dark:hover:bg-dark-700 rounded transition-colors",children:u.includes(s.id)?e.jsx(pe,{className:"w-4 h-4 text-primary-500"}):e.jsx(he,{className:"w-4 h-4 text-slate-400"})})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex items-center gap-1.5 group",children:[e.jsx("span",{className:"font-mono text-sm text-primary-600 dark:text-primary-400",title:s.id,children:Te(s.id)}),e.jsx("button",{onClick:l=>{l.stopPropagation(),se(s.id)},className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-slate-100 dark:hover:bg-dark-700 rounded transition-all",title:t("transactions.copyId"),children:ve===s.id?e.jsx(M,{className:"w-3.5 h-3.5 text-success"}):e.jsx(be,{className:"w-3.5 h-3.5 text-slate-400"})})]})}),e.jsx("td",{className:"px-6 py-6 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:`p-1.5 rounded-lg bg-slate-100 dark:bg-dark-900 ${H(s.cardNumber).color}`,children:H(s.cardNumber).icon}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-mono text-sm font-semibold tracking-wider text-slate-700 dark:text-slate-200",children:s.cardNumber||s.cardId}),e.jsxs("span",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-tighter",children:[H(s.cardNumber).label," Card"]})]})]})}),e.jsx("td",{className:"table-cell",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-md text-sm font-medium ${s.type==="PURCHASE"?"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300":s.type==="RECHARGE"?"bg-success/10 text-success":"bg-warning/10 text-warning"}`,children:[s.type==="PURCHASE"&&e.jsx(ie,{className:"w-4 h-4"}),s.type==="RECHARGE"&&e.jsx(ue,{className:"w-4 h-4"}),s.type==="REFUND"&&e.jsx(I,{className:"w-4 h-4"}),t(`transactions.types.${s.type}`)]})}),e.jsx("td",{className:"table-cell",children:e.jsxs("span",{className:`inline-flex items-center gap-1 font-mono text-base font-bold px-2 py-0.5 rounded ${s.type==="RECHARGE"||s.type==="REFUND"?te(s.amount)?"bg-success/15 text-success":"text-success":te(s.amount)?"bg-error/15 text-error":"text-error"}`,children:[s.type==="RECHARGE"||s.type==="REFUND"?"+":"-",e.jsx("span",{className:"text-xs opacity-60",children:"¥"}),D(s.amount).toFixed(2)]})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:s.terminalLocation||s.terminalName||t("transactions.unknownStation")}),e.jsx("span",{className:"text-xs font-mono text-slate-400 dark:text-slate-500",children:s.terminalId})]})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold border ${s.status==="COMPLETED"?"bg-success/15 text-success border-success/30":s.status==="PENDING"||s.status==="PROCESSING"?"bg-warning/15 text-warning border-warning/30 animate-pulse":s.status==="CANCELLED"?"bg-slate-200 dark:bg-slate-700 text-slate-500 border-slate-300":"bg-error/15 text-error border-error/30"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full mr-1.5 ${s.status==="COMPLETED"?"bg-success animate-pulse":s.status==="PENDING"||s.status==="PROCESSING"?"bg-warning animate-bounce":s.status==="CANCELLED"?"bg-slate-400":"bg-error animate-ping"}`}),t(`transactions.status.${s.status}`)]}),s.status==="FAILED"&&e.jsxs("div",{className:"relative group",children:[e.jsx(U,{className:"w-4 h-4 text-error animate-pulse cursor-help"}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:s.failureReason||t("transactions.errors.unknown")})]})]})}),e.jsx("td",{className:"table-cell",children:s.status==="COMPLETED"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-slate-500",children:[e.jsx(rs,{className:"w-3.5 h-3.5 text-success"}),t("transactions.reconciliation.settled")]}):s.status==="PENDING"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-warning",children:[e.jsx(ne,{className:"w-3.5 h-3.5"}),t("transactions.reconciliation.pending")||"未入账"]}):e.jsx("span",{className:"text-xs text-slate-400",children:"-"})}),e.jsx("td",{className:"table-cell text-slate-500 dark:text-slate-400 text-sm",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1.5 text-slate-400 hover:text-primary-500 hover:bg-primary-500/10 rounded-lg transition-colors",title:t("common.details"),onClick:l=>{l.stopPropagation(),W(s),C(!0)},children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),we(X===s.id?null:s.id)},className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(es,{className:"w-4 h-4"})}),X===s.id&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-36 bg-white dark:bg-dark-800 rounded-lg shadow-xl border border-slate-200 dark:border-dark-600 py-1 z-20",onClick:l=>l.stopPropagation(),children:[s.type==="RECHARGE"&&s.status==="COMPLETED"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-dark-700 flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4"}),t("transactions.printReceipt")||"打印小票"]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-warning hover:bg-warning/10 flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),t("transactions.actions.reverse")||"冲正"]})]}),s.type==="PURCHASE"&&e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-dark-700 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),t("transactions.viewTrail")||"轨迹回放"]}),s.status==="FAILED"&&e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-error hover:bg-error/10 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),t("transactions.viewError")||"查看原因"]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-dark-700 flex items-center gap-2",onClick:()=>se(s.id),children:[e.jsx(be,{className:"w-4 h-4"}),t("transactions.copyId")]})]})]})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-slate-200 dark:border-dark-600",children:[e.jsx("p",{className:"text-sm text-slate-400",children:t("transactions.showing",{count:b.length,total:(i==null?void 0:i.total)||0})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:_,onChange:s=>{ke(Number(s.target.value)),L(1)},className:"px-3 py-2 text-sm bg-slate-100 dark:bg-dark-700 border border-slate-200 dark:border-dark-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[10,30,100].map(s=>e.jsx("option",{value:s,children:t("common.showEntries",{count:s})},s))}),e.jsx("button",{onClick:()=>L(s=>Math.max(1,s-1)),disabled:k===1,className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Je,{className:"w-5 h-5 text-slate-400"})}),e.jsxs("span",{className:"px-4 py-2 bg-primary-500/20 text-primary-400 rounded-lg text-sm font-medium",children:[k," / ",O]}),e.jsx("button",{onClick:()=>L(s=>Math.min(O,s+1)),disabled:k===O,className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Xe,{className:"w-5 h-5 text-slate-400"})})]})]})]}),e.jsx(ce,{children:fe&&r&&e.jsxs(e.Fragment,{children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>C(!1),className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-40"}),e.jsx(p.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed right-0 top-0 bottom-0 w-full max-w-md bg-white dark:bg-dark-800 shadow-2xl z-50 overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h2",{className:"text-xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("transactions.details.title")||"交易详情"}),e.jsx("button",{onClick:()=>C(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-full transition-colors",children:e.jsx(oe,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 bg-slate-50 dark:bg-dark-900 rounded-2xl border border-slate-100 dark:border-dark-600 text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:t(`transactions.types.${r.type}`)}),e.jsxs("p",{className:`text-3xl font-display font-bold ${r.type==="RECHARGE"||r.type==="REFUND"?"text-success":"text-error"}`,children:[r.type==="RECHARGE"||r.type==="REFUND"?"+":"-"," ¥",D(r.amount).toFixed(2)]}),e.jsx("p",{className:"mt-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-white dark:bg-dark-800 border border-slate-200 dark:border-dark-600",children:t(`transactions.status.${r.status}`)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:t("transactions.details.basicInfo")||"基础信息"}),e.jsx(h,{label:t("transactions.table.transactionId"),value:r.id,mono:!0}),e.jsx(h,{label:t("transactions.table.cardId"),value:r.cardNumber||r.cardId,mono:!0}),e.jsx(h,{label:t("transactions.table.timestamp"),value:new Date(r.createdAt).toLocaleString()}),e.jsx(h,{label:t("transactions.table.balance"),value:`¥${D(r.balance).toLocaleString()}`,mono:!0})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-dark-700",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:t("transactions.details.operationInfo")}),e.jsx("div",{className:"py-2",children:e.jsxs("div",{className:"relative flex flex-col gap-4",children:[e.jsx("div",{className:"absolute left-3 top-3 bottom-3 w-0.5 bg-slate-200 dark:bg-dark-600"}),e.jsxs("div",{className:"relative flex items-center gap-4 pl-8",children:[e.jsx("div",{className:"absolute left-0 w-6 h-6 rounded-full bg-success/20 border-2 border-success flex items-center justify-center",children:e.jsx(ge,{className:"w-3 h-3 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("transactions.details.location")}),e.jsx("p",{className:"text-xs text-slate-500",children:r.terminalLocation||t("transactions.unknownStation")})]})]}),e.jsxs("div",{className:"relative flex items-center gap-4 pl-8",children:[e.jsx("div",{className:"absolute left-0 w-6 h-6 rounded-full bg-primary/20 border-2 border-primary flex items-center justify-center",children:e.jsx(le,{className:"w-3 h-3 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("transactions.details.originalSeq")}),e.jsxs("p",{className:"text-xs text-slate-500 font-mono",children:["SEQ-",r.id.split("-")[1]||"002391"]})]})]}),e.jsxs("div",{className:"relative flex items-center gap-4 pl-8",children:[e.jsx("div",{className:`absolute left-0 w-6 h-6 rounded-full border-2 flex items-center justify-center ${r.status==="COMPLETED"?"bg-success/20 border-success":"bg-warning/20 border-warning"}`,children:e.jsx(de,{className:`w-3 h-3 ${r.status==="COMPLETED"?"text-success":"text-warning"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("transactions.table.status")}),e.jsx("p",{className:"text-xs text-slate-500",children:t(`transactions.status.${r.status}`)})]})]})]})}),e.jsx(h,{label:t("transactions.table.terminal"),value:r.terminalName||r.terminalId}),e.jsx(h,{label:t("transactions.details.tacCode"),value:"AABB-CCDD-EEFF-1122",mono:!0}),e.jsx(h,{label:t("transactions.details.settlementCycle"),value:o(new Date(r.createdAt),"yyyyMMdd")})]}),r.status==="FAILED"&&e.jsx("div",{className:"p-4 bg-rose-500/10 border border-rose-500/20 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-rose-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-rose-500 mb-1",children:t("transactions.details.failureReason")}),e.jsx("p",{className:"text-sm text-rose-500/80",children:((ae=r.metadata)==null?void 0:ae.errorMessage)||t("transactions.errors.timeout")}),e.jsx("button",{className:"mt-2 text-xs font-bold text-rose-500 underline hover:no-underline",children:t("transactions.details.retryGuide")})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-6",children:[e.jsxs("button",{className:"btn-secondary py-3 flex items-center justify-center gap-2 text-error hover:bg-error/10 border-error/20",onClick:()=>z(t("transactions.refundInitiated"),t("transactions.refundInProgress")),children:[e.jsx(I,{className:"w-4 h-4"}),t("transactions.actions.refund")||"一键退款"]}),e.jsxs("button",{className:"btn-primary py-3 flex items-center justify-center gap-2",onClick:()=>z(t("transactions.auditPassed"),t("transactions.auditCompleted")),children:[e.jsx(de,{className:"w-4 h-4"}),t("transactions.actions.audit")||"审计通过"]})]})]})]})})]})}),e.jsx(ce,{children:ye&&e.jsxs(e.Fragment,{children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>N(!1),className:"fixed inset-0 bg-black/60 backdrop-blur-md z-[60]"}),e.jsx(p.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg bg-white dark:bg-dark-800 rounded-3xl shadow-2xl z-[70] overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("transactions.export.title")||"高级导出设置"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:t("transactions.export.subtitle")||"自定义您的导出模板和格式"})]}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-full",children:e.jsx(oe,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider",children:t("transactions.export.format")||"文件格式"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>Q("CSV"),className:`p-4 rounded-2xl border-2 transition-all flex items-center justify-center gap-3 ${E==="CSV"?"border-primary-500 bg-primary-500/5 text-primary-600":"border-slate-100 dark:border-dark-700"}`,children:[e.jsx(ts,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold",children:"Excel (CSV)"}),E==="CSV"&&e.jsx(M,{className:"w-4 h-4 ml-auto"})]}),e.jsxs("button",{onClick:()=>Q("PDF"),className:`p-4 rounded-2xl border-2 transition-all flex items-center justify-center gap-3 ${E==="PDF"?"border-primary-500 bg-primary-500/5 text-primary-600":"border-slate-100 dark:border-dark-700"}`,children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold",children:"PDF 账单"}),E==="PDF"&&e.jsx(M,{className:"w-4 h-4 ml-auto"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider",children:t("transactions.export.columns")||"导出字段选择"}),e.jsx("button",{onClick:()=>F(["id","cardId","type","amount","status","timestamp","terminal","balance"]),className:"text-xs text-primary-600 font-bold hover:underline",children:t("common.selectAll")||"全选"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 p-4 bg-slate-50 dark:bg-dark-900 rounded-2xl border border-slate-100 dark:border-dark-700 font-medium",children:[{id:"id",label:t("transactions.table.transactionId")},{id:"cardId",label:t("transactions.table.cardId")},{id:"type",label:t("transactions.table.type")},{id:"amount",label:t("transactions.table.amount")},{id:"status",label:t("transactions.table.status")},{id:"timestamp",label:t("transactions.table.timestamp")},{id:"terminal",label:t("transactions.table.terminal")},{id:"balance",label:t("transactions.table.balance")}].map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-white dark:hover:bg-dark-800 rounded-lg cursor-pointer transition-colors group",children:[e.jsx("div",{className:`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-colors ${f.includes(s.id)?"bg-primary-500 border-primary-500 text-white":"border-slate-300 dark:border-dark-600 bg-transparent"}`,children:f.includes(s.id)&&e.jsx(M,{className:"w-3.5 h-3.5 stroke-[3]"})}),e.jsx("input",{type:"checkbox",className:"hidden",checked:f.includes(s.id),onChange:a=>{a.target.checked?F([...f,s.id]):F(f.filter(l=>l!==s.id))}}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-300 group-hover:text-slate-900 dark:group-hover:text-white",children:s.label})]},s.id))})]}),e.jsxs("div",{className:"pt-4 flex gap-4",children:[e.jsx("button",{onClick:()=>N(!1),className:"flex-1 py-4 bg-slate-100 dark:bg-dark-700 text-slate-700 dark:text-slate-300 font-bold rounded-2x hover:bg-slate-200",children:t("common.cancel")}),e.jsxs("button",{className:"flex-1 py-4 bg-primary-600 text-white font-bold rounded-2xl shadow-xl shadow-primary-500/20 hover:bg-primary-700 transition-all flex items-center justify-center gap-2",onClick:()=>{ee(),N(!1)},children:[e.jsx(as,{className:"w-5 h-5"}),t("transactions.confirmExport")||"立即生成报表"]})]})]})]})})]})})]})}function h({label:t,value:y,mono:g=!1}){return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-slate-500",children:t}),e.jsx("span",{className:`font-medium text-slate-900 dark:text-slate-100 ${g?"font-mono":""}`,children:y})]})}export{ws as default};
