import{g as je,h as Ne,i as ye,l as fe,j as e,L as _,n as F,R as ke,m as j,d as G,a as J,o as ve,b as we,H as Se,A as Ce,E as Z,X as ee,q as Ae}from"./index-BEEygDVJ.js";import{r as n,a as se}from"./vendor-xASHc04L.js";import{u as Ee,a as De,o as Te,s as Ie,n as q,_ as Re}from"./schemas-oLtz9YBc.js";import{u as Pe}from"./i18n-Skc9GWxP.js";import{C as v,S as V}from"./square-XMAAkbau.js";import{B as te,L as Ue,U as Be,H as Le,A as $e}from"./unlock-CZhFqKVr.js";import{C as Fe}from"./calendar-Dz6tJl5I.js";import{W as qe}from"./wallet-Du-B5Yw1.js";import{D as Ve}from"./download-znIT0R9y.js";import{U as Me}from"./upload-BsNHVWyn.js";import{P as Oe}from"./plus-DYCFlYiH.js";import{F as Ye}from"./filter-DZcm0qWx.js";import"./ui-BMjqw1mu.js";import"./charts-X6rqVOAO.js";const Ke=["All Types","STANDARD","STUDENT","SENIOR","STAFF"],ze=["All Status","ACTIVE","SUSPENDED","BLACKLISTED","EXPIRED"],He=Te({type:Re(["STANDARD","STUDENT","SENIOR","STAFF"]),initialBalance:q().min(0).max(1e4),validityYears:q().min(1).max(10),quantity:q().min(1).max(100).optional(),notes:Ie().optional()}),ds=()=>{const{t}=Pe(),[w,M]=n.useState("All Types"),[S,O]=n.useState("All Status"),[Y,K]=n.useState(""),[ae,y]=n.useState(!1),[D,z]=n.useState("grid"),[d,C]=n.useState(null),[A,b]=n.useState(null),[p,f]=n.useState([]),[Xe,le]=n.useState(!1),[c,T]=n.useState({start:"",end:""}),[o,I]=n.useState({min:"",max:""}),[E,re]=n.useState(!1),{data:R,isLoading:ne,isError:ie,error:H,refetch:de}=je({type:w==="All Types"?void 0:w,status:S==="All Status"?void 0:S,search:Y||void 0}),P=Ne(),u=ye(),{data:U}=fe((d==null?void 0:d.id)||""),{register:k,handleSubmit:ce,formState:{errors:h,isSubmitting:X},reset:oe,watch:xe}=Ee({resolver:De(He),defaultValues:{type:"STANDARD",initialBalance:0,validityYears:5,quantity:1,notes:""}}),B=xe("quantity"),x=(R==null?void 0:R.data)||[],Q=(U==null?void 0:U.data)||[],g=n.useMemo(()=>x.filter(s=>{const a=(!c.start||new Date(s.issuedAt)>=new Date(c.start))&&(!c.end||new Date(s.issuedAt)<=new Date(c.end)),l=(!o.min||s.balance>=parseFloat(o.min))&&(!o.max||s.balance<=parseFloat(o.max));return a&&l}),[x,c,o]),N=n.useMemo(()=>{const s=x.length,a=x.reduce((m,ge)=>m+ge.balance,0),l=x.filter(m=>m.status==="ACTIVE").length,r=x.filter(m=>m.status==="SUSPENDED").length,i=x.filter(m=>m.status==="BLACKLISTED").length,be=x.filter(m=>m.status==="EXPIRED").length;return{totalCards:s,totalBalance:a,activeCards:l,suspendedCards:r,blacklistedCards:i,expiredCards:be,averageBalance:s>0?a/s:0}},[x]),me=async s=>{var a,l;b(null);try{const r=s.quantity??1;for(let i=0;i<r;i++)await P.mutateAsync(s);y(!1),oe()}catch(r){b(((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||t("cards.issueError"))}},L=async(s,a)=>{var l,r;b(null);try{await u.mutateAsync({id:s,data:{status:a}})}catch(i){b(((r=(l=i.response)==null?void 0:l.data)==null?void 0:r.message)||t("cards.updateError"))}},$=async s=>{var a,l;b(null);try{await Promise.all(p.map(r=>u.mutateAsync({id:r,data:{status:s}}))),f([]),le(!1)}catch(r){b(((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||t("cards.batchUpdateError"))}},W=s=>{f(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s])},pe=()=>{p.length===g.length?f([]):f(g.map(s=>s.id))},ue=()=>{const s=[["Card Number","Type","Status","Balance","Issued Date","Expiry Date"].join(","),...g.map(i=>[i.number,i.type,i.status,i.balance,i.issuedAt,i.expiresAt].join(","))].join(`
`),a=new Blob([s],{type:"text/csv"}),l=window.URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download=`cards-export-${new Date().toISOString().split("T")[0]}.csv`,r.click()},he=()=>{M("All Types"),O("All Status"),K(""),T({start:"",end:""}),I({min:"",max:""})};return ne?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(_,{className:"w-8 h-8 animate-spin text-primary-600"})}):ie?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[e.jsx(F,{className:"w-12 h-12 text-error"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:H instanceof Error?H.message:t("common.loadError")}),e.jsxs("button",{onClick:()=>de(),className:"btn-secondary flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),t("common.retry")]})]}):e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[A&&e.jsxs("div",{className:"p-4 bg-error/10 border border-error/20 rounded-lg flex items-center gap-3 text-error",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{children:A}),e.jsx("button",{onClick:()=>b(null),className:"ml-auto text-sm hover:underline",children:t("common.dismiss")})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[{label:t("cards.stats.total"),value:N.totalCards,icon:G,color:"blue"},{label:t("cards.stats.active"),value:N.activeCards,icon:v,color:"green"},{label:t("cards.stats.suspended"),value:N.suspendedCards,icon:J,color:"yellow"},{label:t("cards.stats.blacklisted"),value:N.blacklistedCards,icon:te,color:"red"},{label:t("cards.stats.expired"),value:N.expiredCards,icon:Fe,color:"gray"},{label:t("cards.stats.totalBalance"),value:`¥${N.totalBalance.toLocaleString()}`,icon:qe,color:"purple"}].map((s,a)=>e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:s.label}),e.jsx("p",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mt-1",children:s.value})]}),e.jsx("div",{className:`p-2 rounded-lg bg-${s.color}-500/10`,children:e.jsx(s.icon,{className:`w-5 h-5 text-${s.color}-500`})})]})},s.label))}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("cards.title")}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:t("cards.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex bg-slate-100 dark:bg-dark-900 rounded-lg p-1 border border-slate-200 dark:border-dark-600",children:[e.jsx("button",{onClick:()=>z("grid"),className:`p-2 rounded-md transition-colors ${D==="grid"?"bg-white dark:bg-dark-700 text-slate-900 dark:text-slate-200 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z("list"),className:`p-2 rounded-md transition-colors ${D==="list"?"bg-white dark:bg-dark-700 text-slate-900 dark:text-slate-200 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:ue,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),t("common.export")]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),t("common.import")]}),e.jsxs("button",{onClick:()=>y(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),t("cards.issueCard")]})]})]}),e.jsxs("div",{className:"glass-panel p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[300px] relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 dark:text-slate-500"}),e.jsx("input",{type:"text",placeholder:t("common.search"),value:Y,onChange:s=>K(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-50 dark:bg-dark-900 border border-slate-200 dark:border-dark-600 rounded-lg text-slate-900 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:border-primary-500/50"})]}),e.jsx("select",{value:w,onChange:s=>M(s.target.value),className:"px-4 py-2 bg-slate-50 dark:bg-dark-900 border border-slate-200 dark:border-dark-600 rounded-lg text-slate-900 dark:text-slate-200 focus:outline-none focus:border-primary-500/50",children:Ke.map(s=>e.jsx("option",{value:s,children:t(s==="All Types"?"common.allTypes":`cards.types.${s}`)},s))}),e.jsx("select",{value:S,onChange:s=>O(s.target.value),className:"px-4 py-2 bg-slate-50 dark:bg-dark-900 border border-slate-200 dark:border-dark-600 rounded-lg text-slate-900 dark:text-slate-200 focus:outline-none focus:border-primary-500/50",children:ze.map(s=>e.jsx("option",{value:s,children:t(s==="All Status"?"common.allStatus":`cards.status.${s}`)},s))}),e.jsxs("button",{onClick:()=>re(!E),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${E?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-600":"border-slate-200 dark:border-dark-600 hover:bg-slate-50 dark:hover:bg-dark-700"}`,children:[e.jsx(Ye,{className:"w-4 h-4"}),t("common.advancedFilters"),e.jsx(Se,{className:`w-4 h-4 transition-transform ${E?"rotate-180":""}`})]}),(w!=="All Types"||S!=="All Status"||c.start||c.end||o.min||o.max)&&e.jsx("button",{onClick:he,className:"text-sm text-primary-600 hover:underline",children:t("common.clearFilters")})]}),e.jsx(Ce,{children:E&&e.jsx(j.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"pt-4 border-t border-slate-200 dark:border-dark-600 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:t("cards.filters.dateRange")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:c.start,onChange:s=>T(a=>({...a,start:s.target.value})),className:"flex-1 input-field"}),e.jsx("span",{className:"self-center text-slate-400",children:"-"}),e.jsx("input",{type:"date",value:c.end,onChange:s=>T(a=>({...a,end:s.target.value})),className:"flex-1 input-field"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:t("cards.filters.balanceRange")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"Min",value:o.min,onChange:s=>I(a=>({...a,min:s.target.value})),className:"flex-1 input-field"}),e.jsx("span",{className:"self-center text-slate-400",children:"-"}),e.jsx("input",{type:"number",placeholder:"Max",value:o.max,onChange:s=>I(a=>({...a,max:s.target.value})),className:"flex-1 input-field"})]})]})]})})})]}),p.length>0&&e.jsxs(j.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-4 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"w-5 h-5 text-primary-600"}),e.jsx("span",{className:"font-medium text-primary-900 dark:text-primary-100",children:t("cards.selectedCount",{count:p.length})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$("ACTIVE"),disabled:u.isPending,className:"px-4 py-2 text-sm font-medium text-success bg-success/10 hover:bg-success/20 rounded-lg transition-colors",children:t("cards.activateAll")}),e.jsx("button",{onClick:()=>$("SUSPENDED"),disabled:u.isPending,className:"px-4 py-2 text-sm font-medium text-warning bg-warning/10 hover:bg-warning/20 rounded-lg transition-colors",children:t("cards.suspendAll")}),e.jsx("button",{onClick:()=>$("BLACKLISTED"),disabled:u.isPending,className:"px-4 py-2 text-sm font-medium text-error bg-error/10 hover:bg-error/20 rounded-lg transition-colors",children:t("cards.blacklistAll")}),e.jsx("button",{onClick:()=>f([]),className:"px-4 py-2 text-sm text-slate-500 hover:text-slate-700",children:t("common.clearSelection")})]})]}),D==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:g.map((s,a)=>e.jsxs(j.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:a*.03},className:`glass-panel p-6 group hover:border-primary-500/30 transition-all duration-300 ${p.includes(s.id)?"border-primary-500 ring-2 ring-primary-500/20":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>W(s.id),className:"p-1 hover:bg-slate-100 dark:hover:bg-dark-700 rounded transition-colors",children:p.includes(s.id)?e.jsx(v,{className:"w-5 h-5 text-primary-500"}):e.jsx(V,{className:"w-5 h-5 text-slate-400"})}),e.jsx("div",{className:`p-3 rounded-xl ${s.status==="ACTIVE"?"bg-success/10":s.status==="SUSPENDED"?"bg-warning/10":"bg-error/10"}`,children:e.jsx(G,{className:`w-6 h-6 ${s.status==="ACTIVE"?"text-success":s.status==="SUSPENDED"?"text-warning":"text-error"}`})})]}),e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:()=>C(s),className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(Z,{className:"w-4 h-4 text-slate-400"})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:t("cards.cardNumber")}),e.jsx("p",{className:"font-mono text-lg text-slate-900 dark:text-slate-200 tracking-wider",children:s.number})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:t("cards.type")}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-slate-100 dark:bg-dark-700 text-slate-600 dark:text-slate-300",children:t(`cards.types.${s.type}`)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:t("cards.status")}),e.jsx("span",{className:`badge ${s.status==="ACTIVE"?"badge-success":s.status==="SUSPENDED"?"badge-warning":"badge-error"}`,children:t(`cards.status.${s.status}`)})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:t("cards.balance")}),e.jsxs("p",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:["¥",s.balance.toLocaleString()]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-200 dark:border-dark-600",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:[t("cards.issued"),": ",s.issuedAt]}),e.jsxs("span",{children:[t("cards.expires"),": ",s.expiresAt]})]})}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[s.status==="ACTIVE"?e.jsxs("button",{onClick:()=>L(s.id,"SUSPENDED"),disabled:u.isPending,className:"flex-1 py-2 text-xs font-medium text-warning bg-warning/10 hover:bg-warning/20 rounded-lg transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[e.jsx(J,{className:"w-3 h-3"}),t("cards.suspend")]}):e.jsxs("button",{onClick:()=>L(s.id,"ACTIVE"),disabled:u.isPending,className:"flex-1 py-2 text-xs font-medium text-success bg-success/10 hover:bg-success/20 rounded-lg transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[e.jsx(Be,{className:"w-3 h-3"}),t("cards.activate")]}),e.jsxs("button",{onClick:()=>L(s.id,"BLACKLISTED"),disabled:u.isPending,className:"flex-1 py-2 text-xs font-medium text-error bg-error/10 hover:bg-error/20 rounded-lg transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[e.jsx(te,{className:"w-3 h-3"}),t("cards.blacklist")]})]})]},s.id))}):e.jsx("div",{className:"glass-panel overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50/50 dark:bg-dark-900/50 text-xs uppercase text-slate-500 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-medium",children:e.jsx("button",{onClick:pe,className:"flex items-center gap-2",children:p.length===g.length&&g.length>0?e.jsx(v,{className:"w-4 h-4 text-primary-500"}):e.jsx(V,{className:"w-4 h-4"})})}),e.jsx("th",{className:"px-6 py-4 font-medium",children:t("cards.cardNumber")}),e.jsx("th",{className:"px-6 py-4 font-medium",children:t("cards.type")}),e.jsx("th",{className:"px-6 py-4 font-medium",children:t("cards.status")}),e.jsx("th",{className:"px-6 py-4 font-medium text-right",children:t("cards.balance")}),e.jsx("th",{className:"px-6 py-4 font-medium",children:t("cards.issued")}),e.jsx("th",{className:"px-6 py-4 font-medium",children:t("cards.expires")}),e.jsx("th",{className:"px-6 py-4 font-medium"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-dark-600",children:g.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50/50 dark:hover:bg-dark-700/50 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>W(s.id),children:p.includes(s.id)?e.jsx(v,{className:"w-4 h-4 text-primary-500"}):e.jsx(V,{className:"w-4 h-4 text-slate-400"})})}),e.jsx("td",{className:"px-6 py-4 font-mono text-slate-900 dark:text-slate-200",children:s.number}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-slate-100 dark:bg-dark-700 text-slate-600 dark:text-slate-300",children:t(`cards.types.${s.type}`)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`badge ${s.status==="ACTIVE"?"badge-success":s.status==="SUSPENDED"?"badge-warning":"badge-error"}`,children:t(`cards.status.${s.status}`)})}),e.jsxs("td",{className:"px-6 py-4 text-right font-mono text-slate-900 dark:text-slate-200",children:["¥",s.balance.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 text-slate-500 dark:text-slate-400 text-sm",children:s.issuedAt}),e.jsx("td",{className:"px-6 py-4 text-slate-500 dark:text-slate-400 text-sm",children:s.expiresAt}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:()=>C(s),className:"p-2 hover:bg-slate-200 dark:hover:bg-dark-600 rounded-lg text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200",children:e.jsx(Z,{className:"w-4 h-4"})})})})]},s.id))})]})}),ae&&se.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4",onClick:s=>{s.target===s.currentTarget&&y(!1)},children:e.jsxs(j.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"glass-panel w-full max-w-lg p-6 bg-white dark:bg-dark-800 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("cards.issueNewCard")}),e.jsx("button",{onClick:()=>y(!1),className:"text-slate-400 hover:text-slate-500 dark:hover:text-slate-300 transition-colors",children:e.jsx(ee,{className:"w-5 h-5"})})]}),A&&e.jsxs("div",{className:"mb-4 p-3 bg-error/10 border border-error/20 rounded-lg flex items-center gap-2 text-error text-sm",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:A})]}),e.jsxs("form",{onSubmit:ce(me),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:t("cards.type")}),e.jsxs("select",{...k("type"),className:"w-full input-field",children:[e.jsx("option",{value:"STANDARD",children:t("cards.types.STANDARD")}),e.jsx("option",{value:"STUDENT",children:t("cards.types.STUDENT")}),e.jsx("option",{value:"SENIOR",children:t("cards.types.SENIOR")}),e.jsx("option",{value:"STAFF",children:t("cards.types.STAFF")})]}),h.type&&e.jsx("p",{className:"mt-1 text-sm text-error",children:h.type.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:t("cards.quantity")}),e.jsx("input",{type:"number",...k("quantity",{valueAsNumber:!0}),className:"input-field",min:1,max:100}),h.quantity&&e.jsx("p",{className:"mt-1 text-sm text-error",children:h.quantity.message}),B&&B>1&&e.jsx("p",{className:"mt-1 text-sm text-primary-600",children:t("cards.willIssue",{count:B})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:[t("cards.initialBalance")," (¥)"]}),e.jsx("input",{type:"number",...k("initialBalance",{valueAsNumber:!0}),className:"input-field",placeholder:"0"}),h.initialBalance&&e.jsx("p",{className:"mt-1 text-sm text-error",children:h.initialBalance.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:[t("cards.validityPeriod")," (",t("common.years"),")"]}),e.jsx("input",{type:"number",...k("validityYears",{valueAsNumber:!0}),className:"input-field"}),h.validityYears&&e.jsx("p",{className:"mt-1 text-sm text-error",children:h.validityYears.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:t("cards.notes")}),e.jsx("textarea",{...k("notes"),className:"input-field h-24 resize-none",placeholder:t("cards.notesPlaceholder")})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"flex-1 btn-secondary",children:t("common.cancel")}),e.jsxs("button",{type:"submit",disabled:X||P.isPending,className:"flex-1 btn-primary flex items-center justify-center gap-2 disabled:opacity-50",children:[(X||P.isPending)&&e.jsx(_,{className:"w-4 h-4 animate-spin"}),t("cards.issueCard")]})]})]})]})}),document.body),d&&se.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex justify-end",onClick:()=>C(null),children:e.jsx(j.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"w-full max-w-2xl bg-white dark:bg-dark-800 h-full border-l border-slate-200 dark:border-dark-600 shadow-2xl overflow-y-auto",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("cards.details")}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-mono mt-1",children:d.number})]}),e.jsx("button",{onClick:()=>C(null),className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg transition-colors text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200",children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"p-4 bg-slate-50/50 dark:bg-dark-900/50 rounded-xl border border-slate-200 dark:border-dark-700",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:t("cards.balance")}),e.jsxs("p",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:["¥",d.balance.toLocaleString()]})]}),e.jsxs("div",{className:"p-4 bg-slate-50/50 dark:bg-dark-900/50 rounded-xl border border-slate-200 dark:border-dark-700",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:t("cards.status")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${d.status==="ACTIVE"?"bg-success":d.status==="SUSPENDED"?"bg-warning":"bg-error"}`}),e.jsx("span",{className:"text-lg font-medium text-slate-900 dark:text-slate-200",children:t(`cards.status.${d.status}`)})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),t("cards.history")]}),e.jsx("div",{className:"space-y-4",children:Q.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-8",children:t("cards.noTransactions")}):Q.map(s=>e.jsxs("div",{className:"p-4 bg-slate-50/30 dark:bg-dark-900/30 rounded-xl border border-slate-200 dark:border-dark-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.type==="CREDIT"?"bg-success/10 text-success":"bg-primary-500/10 text-primary-600 dark:text-primary-400"}`,children:s.type==="CREDIT"?e.jsx($e,{className:"w-5 h-5"}):e.jsx(Ae,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-slate-200",children:s.type==="CREDIT"?t("cards.topUp"):t("cards.payment")}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.terminal," • ",s.timestamp]})]})]}),e.jsxs("span",{className:`font-mono font-medium ${s.type==="CREDIT"?"text-success":"text-slate-900 dark:text-slate-200"}`,children:[s.type==="CREDIT"?"+":"-","¥",s.amount.toLocaleString()]})]},s.id))})]})]})})}),document.body)]})};export{ds as default};
