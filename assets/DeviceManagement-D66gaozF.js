import{c as ye,j as e,A as Z,m as k,z as Ie,R as He,B as se,a1 as Ge,X as ke,ad as Ot,ae as Le,$ as Pt,af as ve,ag as Re,C as gt,H as Ee,ah as ot,ai as ft,aj as Xe,ak as jt,al as vt,am as qe,an as _t,ao as Wt,n as ae,D as ue,u as Nt,ap as zt,aq as Vt,M as Bt,b as ge,e as he,E as yt,r as kt,ar as wt,_ as Kt,d as Ut,a0 as Ht,as as Gt,L as pe,at as Xt,p as qt,au as Ct,av as Yt}from"./index-BFkHSXE8.js";import{r as o,b as Qt,f as Zt,h as de,d as Dt,a as Jt}from"./vendor-xASHc04L.js";import{u as es,a as ts,o as Tt,s as te,b as ss,n as as}from"./schemas-oLtz9YBc.js";import{u as z}from"./i18n-Skc9GWxP.js";import{P as be}from"./plus-CIEzPpAK.js";import{C as $e}from"./cpu-CA94A6R4.js";import{W as me}from"./wrench-1UGSiQkU.js";import{C as Ye}from"./check-CaHv72ax.js";import{U as Ke}from"./upload-CRCrYpLJ.js";import{W as St}from"./wifi-IjZWLN5x.js";import{B as mt,H as Qe}from"./hard-drive-KxzoQOwn.js";import{R as xe,P as xt,b as ht,c as pt,T as Be,f as rs,A as Me,C as ls,X as is,Y as ns,a as fe}from"./charts-X6rqVOAO.js";import{F as ds}from"./filter-BXwfgd0z.js";import{D as Ae}from"./download-BCDTra7Q.js";import{M as Ue}from"./more-horizontal-BUv4BwW_.js";import{F as cs}from"./file-text-fcMP8QZk.js";import{T as Mt}from"./trash-2-Dn5u56zO.js";import{P as os}from"./printer-D7BU3rgz.js";import"./ui-BMjqw1mu.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=ye("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=ye("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=ye("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=ye("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=ye("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),hs=[{key:"add",icon:be,label:"mdm.addDevice",color:"primary"},{key:"reboot_all",icon:Ie,label:"mdm.bulkActions.reboot",color:"red"},{key:"sync",icon:He,label:"mdm.cmdSyncTime",color:"blue"},{key:"activity",icon:se,label:"devices.health",color:"green"},{key:"radar",icon:ms,label:"devices.healthOverview",color:"purple"},{key:"settings",icon:Ge,label:"mdm.remote.hotConfig",color:"slate"}],ps={primary:"text-primary-500 bg-primary-500/10 hover:bg-primary-500/20 border-primary-500/20",red:"text-red-500 bg-red-500/10 hover:bg-red-500/20 border-red-500/20",blue:"text-blue-500 bg-blue-500/10 hover:bg-blue-500/20 border-blue-500/20",green:"text-green-500 bg-green-500/10 hover:bg-green-500/20 border-green-500/20",purple:"text-purple-500 bg-purple-500/10 hover:bg-purple-500/20 border-purple-500/20",slate:"text-slate-500 bg-slate-500/10 hover:bg-slate-500/20 border-slate-500/20"},bs=({onAction:t})=>{const{t:c}=z(),[d,x]=o.useState(!1),j={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{staggerChildren:.05,delayChildren:.1}},exit:{opacity:0,scale:.8,transition:{staggerChildren:.05,staggerDirection:-1}}},h={hidden:{opacity:0,y:20},visible:{opacity:1,y:0},exit:{opacity:0,y:10}};return e.jsxs("div",{className:"hidden md:flex fixed z-[100] flex-col items-end",style:{right:"2rem",bottom:"calc(2rem + env(safe-area-inset-bottom, 0px))"},"data-cursor":"gear",children:[e.jsx(Z,{children:d&&e.jsx(k.div,{variants:j,initial:"hidden",animate:"visible",exit:"exit",className:"flex flex-col gap-3 mb-4 items-end",children:hs.map(p=>e.jsxs(k.button,{variants:h,whileHover:{scale:1.05,x:-5},whileTap:{scale:.95},onClick:()=>{x(!1),t(p.key)},"aria-label":c(p.label),className:`flex items-center gap-3 px-4 py-2.5 rounded-2xl glass-panel shadow-lg backdrop-blur-xl border border-white/20 dark:border-white/10 group ${ps[p.color]}`,children:[e.jsx("span",{className:"text-sm font-medium whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity absolute right-14 pr-2",children:c(p.label)}),e.jsx(p.icon,{className:"w-5 h-5 flex-shrink-0"})]},p.key))})}),e.jsxs(k.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>x(!d),"aria-label":c(d?"common.close":"common.menu"),className:"w-14 h-14 rounded-full bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 shadow-xl shadow-cyan-500/30 flex items-center justify-center hover:shadow-cyan-500/50 transition-shadow relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-cyan-500/20 to-transparent pointer-events-none"}),e.jsx(Z,{mode:"wait",children:d?e.jsx(k.div,{initial:{rotate:-90,opacity:0},animate:{rotate:0,opacity:1},exit:{rotate:90,opacity:0},transition:{duration:.2},children:e.jsx(ke,{className:"w-6 h-6"})},"close"):e.jsx(k.div,{initial:{rotate:90,opacity:0},animate:{rotate:0,opacity:1},exit:{rotate:-90,opacity:0},transition:{duration:.2},children:e.jsx(Ot,{className:"w-6 h-6"})},"menu")})]})]})},ut=["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6"],Fe={bottom:"calc(90px + env(safe-area-inset-bottom, 0px))"},ce={blue:{bg:"bg-blue-500/10",text:"text-blue-500",textDark:"dark:text-blue-400"},green:{bg:"bg-green-500/10",text:"text-green-500",textDark:"dark:text-green-400"},purple:{bg:"bg-purple-500/10",text:"text-purple-500",textDark:"dark:text-purple-400"},orange:{bg:"bg-orange-500/10",text:"text-orange-500",textDark:"dark:text-orange-400"},red:{bg:"bg-red-500/10",text:"text-red-500",textDark:"dark:text-red-400"},cyan:{bg:"bg-cyan-500/10",text:"text-cyan-500",textDark:"dark:text-cyan-400"},amber:{bg:"bg-amber-500/10",text:"text-amber-500",textDark:"dark:text-amber-400"},pink:{bg:"bg-pink-500/10",text:"text-pink-500",textDark:"dark:text-pink-400"},slate:{bg:"bg-slate-500/10",text:"text-slate-500",textDark:"dark:text-slate-400"}},us=Tt({type:te().min(1),serialNumber:te().min(1).max(50),vehicleId:te().optional(),terminalId:te().optional()});Tt({version:te().min(1),changelog:te().min(1),downloadUrl:te().url(),fileSize:as().min(1),checksum:te().min(1),isMandatory:ss()});const gs=({onClose:t,onSubmit:c,isSubmitting:d,methods:x})=>{const{t:j}=z();return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[70] flex items-center justify-center p-4",children:e.jsxs(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"glass-panel w-full max-w-lg p-6 bg-white dark:bg-dark-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-display font-bold text-slate-900 dark:text-slate-100",children:j("mdm.createDevice")}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg",children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:x.handleSubmit(c),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:j("mdm.deviceType")}),e.jsx("input",{...x.register("type"),className:"input-field",placeholder:"P18Q"}),x.formState.errors.type&&e.jsx("p",{className:"mt-1 text-sm text-error",children:x.formState.errors.type.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500 dark:text-slate-400 mb-2",children:j("mdm.serialNumber")}),e.jsx("input",{...x.register("serialNumber"),className:"input-field",placeholder:"SN001"}),x.formState.errors.serialNumber&&e.jsx("p",{className:"mt-1 text-sm text-error",children:x.formState.errors.serialNumber.message})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 btn-secondary",children:j("common.cancel")}),e.jsxs("button",{type:"submit",disabled:d,className:"flex-1 btn-primary flex items-center justify-center gap-2 disabled:opacity-50",children:[d&&e.jsx(pe,{className:"w-4 h-4 animate-spin"}),j("common.confirm")]})]})]})]})})},fs=({deviceId:t,onClose:c})=>{const{t:d}=z(),{data:x}=Yt(t),[j,h]=o.useState("info");if(!x)return null;const p=[{date:"2024-01-15",type:"ARCHIVE",desc:"Device archived into inventory"},{date:"2024-02-01",type:"BIND",desc:"Bound to Line 202, Station Green Valley"},{date:"2024-06-15",type:"MAINTENANCE",desc:"Routine battery check completed"},{date:"2025-01-10",type:"UPGRADE",desc:"Firmware upgraded to v2.1.0"}];return e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,className:"fixed inset-0 bg-black/30 z-[70]"}),e.jsxs(k.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed right-0 top-0 h-full w-full max-w-xl bg-white dark:bg-dark-800 z-[80] shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-dark-600 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-display font-bold text-slate-900 dark:text-slate-100",children:x.id}),e.jsx("p",{className:"text-sm text-slate-500",children:x.serialNumber})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg",children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-slate-200 dark:border-dark-600",children:[e.jsx("button",{onClick:()=>h("info"),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${j==="info"?"border-primary-500 text-primary-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:d("common.details")}),e.jsx("button",{onClick:()=>h("lifecycle"),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${j==="lifecycle"?"border-primary-500 text-primary-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:d("mdm.lifecycle")})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:j==="info"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:d("mdm.hardwareInfo")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:d("mdm.manufacturer")}),e.jsx("span",{className:"font-medium text-right ml-4 break-all",children:x.manufacturer})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:d("mdm.model")}),e.jsx("span",{className:"font-medium text-right ml-4 break-all",children:x.model})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:d("mdm.purchaseDate")}),e.jsx("span",{className:"font-medium text-right ml-4",children:x.purchaseDate})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:d("mdm.status")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:d("mdm.battery")}),e.jsxs("span",{className:"font-medium",children:[x.battery,"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:d("mdm.storage")}),e.jsxs("span",{className:"font-medium",children:[x.storage,"%"]})]})]})]})]}):e.jsx("div",{className:"relative pl-8 space-y-8 before:absolute before:left-[11px] before:top-2 before:bottom-2 before:w-0.5 before:bg-slate-200 dark:before:bg-dark-600",children:p.map((u,n)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-8 w-6 h-6 rounded-full border-4 border-white dark:border-dark-800 flex items-center justify-center ${u.type==="ARCHIVE"?"bg-blue-500":u.type==="BIND"?"bg-green-500":u.type==="MAINTENANCE"?"bg-amber-500":"bg-purple-500"}`,children:u.type==="UPGRADE"?e.jsx(je,{className:"w-3 h-3 text-white"}):e.jsx(Ye,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:u.date}),e.jsx("p",{className:"font-bold text-sm text-slate-900 dark:text-slate-100",children:d(`mdm.events.${u.type}`)}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:u.desc})]})]},n))})}),e.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-dark-600 flex justify-end",children:e.jsx("button",{onClick:c,className:"btn-secondary",children:d("common.close")})})]})]})},js=({deviceId:t,onClose:c})=>{const{t:d}=z(),{data:x,isLoading:j,isError:h,refetch:p}=Ct({deviceId:t,limit:50},{enabled:!!t,retry:!1}),u=((x==null?void 0:x.data)||[]).filter(n=>n.level==="ERROR"||n.level==="FATAL").sort((n,D)=>new Date(D.timestamp).getTime()-new Date(n.timestamp).getTime()).slice(0,10);return e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,className:"fixed inset-0 bg-black/30 z-[70]"}),e.jsxs(k.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed right-0 top-0 h-full w-full max-w-lg bg-white dark:bg-dark-800 z-[80] shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-dark-600 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-display font-bold text-slate-900 dark:text-slate-100",children:d("devices.offlineLogsTitle",{deviceId:t})}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:d("devices.offlineLogsSubtitle")})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-slate-100 dark:hover:bg-dark-700 rounded-lg",children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[j&&e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx(pe,{className:"w-6 h-6 animate-spin text-primary-600"})}),h&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx(ae,{className:"w-10 h-10 mx-auto mb-3 text-error"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:d("common.loadError")}),e.jsx("button",{onClick:()=>p(),className:"btn-secondary mt-4",children:d("common.retry")})]}),!j&&!h&&u.length===0&&e.jsxs("div",{className:"text-center py-10 text-slate-500",children:[e.jsx(ae,{className:"w-10 h-10 mx-auto mb-3 opacity-60"}),e.jsx("p",{children:d("devices.noErrorLogs")})]}),!j&&!h&&u.length>0&&e.jsx("div",{className:"space-y-3",children:u.map(n=>e.jsxs("div",{className:"p-4 rounded-xl border border-slate-200 dark:border-dark-600 bg-slate-50 dark:bg-dark-700/40",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${n.level==="FATAL"?"bg-red-800 text-white":"bg-red-600 text-white"}`,children:n.level}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(n.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 break-all whitespace-pre-wrap",children:n.message})]},n.id))})]}),e.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-dark-600 flex justify-end",children:e.jsx("button",{onClick:c,className:"btn-secondary",children:d("common.close")})})]})]})},vs=()=>{var re,K,J,L,G,X,q,i,w,M,S;const{t}=z(),c=Le(),[d,x]=o.useState("24h"),[j,h]=o.useState(new Date),[p,u]=o.useState(()=>window.innerWidth<768),{data:n,refetch:D}=ft(),{data:r}=Xe(!0),{data:m}=jt(),{data:f}=vt(),{data:y}=qe(),{data:O}=_t(),{data:b}=Wt();y!=null&&y.data;const C=O||{totalDevices:0,onlineDevices:0,offlineDevices:0,maintenanceDevices:0,alertsToday:0,upgradesInProgress:0};o.useEffect(()=>{const a=setInterval(()=>{h(new Date)},1e3);return()=>clearInterval(a)},[]),o.useEffect(()=>{const a=()=>u(window.innerWidth<768);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const v=n!=null&&n.healthDistribution?Object.entries(n.healthDistribution).map(([a,N])=>({name:t(`health.${a.toLowerCase()}`),value:N,status:a})):[],P=[{name:t("mdm.online"),value:C.onlineDevices,color:"#10b981"},{name:t("mdm.offline"),value:C.offlineDevices,color:"#ef4444"},{name:t("mdm.maintenance"),value:C.maintenanceDevices,color:"#f59e0b"}],W=[{time:"00:00",cpu:35,memory:42,battery:85},{time:"04:00",cpu:28,memory:38,battery:82},{time:"08:00",cpu:55,memory:62,battery:75},{time:"12:00",cpu:72,memory:78,battery:65},{time:"16:00",cpu:68,memory:71,battery:58},{time:"20:00",cpu:45,memory:52,battery:52},{time:"23:59",cpu:38,memory:45,battery:48}],V=a=>a>=90?"#10b981":a>=75?"#3b82f6":a>=60?"#f59e0b":a>=40?"#f97316":"#ef4444",H=a=>a>=90?t("health.excellent"):a>=75?t("health.good"):a>=60?t("health.fair"):a>=40?t("health.poor"):t("health.critical"),B=a=>t(`mdm.maintenanceTypes.${a.toLowerCase()}`);return e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("devices.dashboard")}),e.jsx("p",{className:"hidden md:block text-slate-500 dark:text-slate-400 mt-1 text-sm lg:text-base",children:t("devices.dashboardSubtitle")})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 lg:gap-3",children:[e.jsxs("select",{value:d,onChange:a=>x(a.target.value),className:"input-field text-sm",children:[e.jsx("option",{value:"1h",children:t("time.last1h")}),e.jsx("option",{value:"24h",children:t("time.last24h")}),e.jsx("option",{value:"7d",children:t("time.last7d")}),e.jsx("option",{value:"30d",children:t("time.last30d")})]}),e.jsxs("button",{onClick:()=>D(),className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("common.refresh")})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[t("common.lastUpdated"),": ",j.toLocaleTimeString()]})]})]}),e.jsx("div",{className:"md:hidden grid grid-cols-2 gap-2.5",children:[{path:"/devices/list",labelKey:"devices.deviceList",icon:ve,color:"bg-blue-500/10 text-blue-500",desc:`${C.totalDevices} ${t("mdm.stats.totalDevices")}`},{path:"/devices/health",labelKey:"devices.health",icon:se,color:"bg-green-500/10 text-green-500",desc:`${(n==null?void 0:n.averageScore)||0}/100`},{path:"/devices/firmware",labelKey:"devices.firmware",icon:$e,color:"bg-purple-500/10 text-purple-500",desc:`${C.upgradesInProgress||0} ${t("mdm.upgradesInProgress")}`},{path:"/devices/remote",labelKey:"devices.remote",icon:Re,color:"bg-amber-500/10 text-amber-500"},{path:"/devices/logs",labelKey:"devices.logs",icon:Ne,color:"bg-cyan-500/10 text-cyan-500"},{path:"/devices/maintenance",labelKey:"devices.maintenance",icon:me,color:"bg-orange-500/10 text-orange-500",desc:`${((re=r==null?void 0:r.upcomingMaintenance)==null?void 0:re.length)||0} ${t("maintenance.upcoming")}`}].map((a,N)=>e.jsxs(k.button,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:N*.04},onClick:()=>c(a.path),className:"flex items-center gap-3 p-3.5 rounded-xl border border-slate-200 dark:border-dark-700 bg-white dark:bg-dark-800 hover:shadow-md active:scale-[0.97] transition-all text-left",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center shrink-0 ${a.color.split(" ")[0]}`,children:e.jsx(a.icon,{className:`w-5 h-5 ${a.color.split(" ")[1]}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 truncate",children:t(a.labelKey)}),a.desc&&e.jsx("p",{className:"text-[11px] text-slate-500 mt-0.5 truncate",children:a.desc})]})]},a.path))}),e.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-2 scrollbar-hide snap-x shrink-0",children:[e.jsxs("button",{onClick:()=>c("/devices/list?status=offline"),className:"shrink-0 snap-start flex items-center gap-2 px-4 py-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors active:scale-95",children:[e.jsx(bt,{className:"w-4 h-4 text-red-500"}),e.jsxs("span",{className:"text-sm font-semibold text-red-700 dark:text-red-300",children:[t("mdm.offline"),": ",C.offlineDevices]})]}),e.jsxs("button",{onClick:()=>c("/devices"),className:"shrink-0 snap-start flex items-center gap-2 px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg hover:bg-amber-100 dark:hover:bg-amber-900/40 transition-colors active:scale-95",children:[e.jsx(ae,{className:"w-4 h-4 text-amber-500"}),e.jsxs("span",{className:"text-sm font-semibold text-amber-700 dark:text-amber-300",children:[t("mdm.stats.critical"),": ",C.alertsToday||0]})]}),e.jsxs("button",{onClick:()=>c("/devices/firmware"),className:"shrink-0 snap-start flex items-center gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors active:scale-95",children:[e.jsx(Ke,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:[t("mdm.upgradesInProgress"),": ",C.upgradesInProgress||0]})]})]}),b&&b.length>0&&e.jsxs(k.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg self-start",children:e.jsx(ue,{className:"w-5 h-5 text-amber-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-amber-800 dark:text-amber-200",children:t("mdm.inventory.lowStockTitle",{count:b.length})}),e.jsx("div",{className:"grid grid-cols-1 sm:flex sm:flex-wrap gap-2 sm:gap-4 mt-2",children:b.map(a=>e.jsxs("span",{className:"text-xs text-amber-600 dark:text-amber-400",children:["â€¢ ",t(`common.types.${a.type}`),": ",a.stock," (",t("mdm.inventory.threshold",{value:a.threshold}),")"]},a.type))})]}),e.jsx("button",{className:"w-full sm:w-auto text-sm font-medium text-amber-700 dark:text-amber-300 hover:underline text-left sm:text-right",children:t("common.viewDetails")})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-9 gap-3 md:gap-4",children:[{label:t("mdm.stats.totalDevices"),value:C.totalDevices,icon:ve,color:"blue",trend:"+2%"},{label:t("mdm.stats.online"),value:C.onlineDevices,icon:St,color:"green",trend:"+5%"},{label:t("mdm.stats.offline"),value:C.offlineDevices,icon:bt,color:"red",trend:"-1%"},{label:t("mdm.stats.healthScore"),value:(n==null?void 0:n.averageScore)||0,icon:se,color:"purple",suffix:"/100"},{label:t("mdm.stats.critical"),value:((K=r==null?void 0:r.summary)==null?void 0:K.criticalCount)||0,icon:ue,color:"red"},{label:t("mdm.stats.maintenance"),value:((J=r==null?void 0:r.upcomingMaintenance)==null?void 0:J.length)||0,icon:me,color:"orange"},{label:t("mdm.stats.deployments"),value:(m==null?void 0:m.length)||0,icon:je,color:"cyan"},{label:t("mdm.stats.anomalies"),value:(f==null?void 0:f.length)||0,icon:mt,color:"pink"},{label:t("mdm.stats.inventoryAlert"),value:(b==null?void 0:b.length)||0,icon:Qe,color:"amber"}].map((a,N)=>{var I,U;return e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:N*.05},className:`stat-card p-4 md:p-6 cursor-pointer hover:shadow-lg transition-shadow active:scale-[0.98] ${N>3?"hidden md:block":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:a.label}),e.jsxs("p",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mt-1",children:[a.value,a.suffix||""]}),a.trend&&e.jsx("p",{className:`text-xs mt-1 ${a.trend.startsWith("+")?"text-success":"text-error"}`,children:a.trend})]}),e.jsx("div",{className:`p-2 rounded-lg ${((I=ce[a.color])==null?void 0:I.bg)??"bg-slate-500/10"}`,children:e.jsx(a.icon,{className:`w-4 h-4 ${((U=ce[a.color])==null?void 0:U.text)??"text-slate-500"}`})})]})},a.label)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:t("mdm.dashboard.fleetHealth")}),e.jsx("p",{className:"text-sm text-slate-500",children:t("mdm.dashboard.fleetHealthDesc")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-3xl font-bold",style:{color:V((n==null?void 0:n.averageScore)||0)},children:(n==null?void 0:n.averageScore)||0}),e.jsx("p",{className:"text-sm text-slate-500",children:H((n==null?void 0:n.averageScore)||0)})]})]}),e.jsx("div",{className:"h-48",children:e.jsx(xe,{width:"100%",height:"100%",children:e.jsxs(xt,{children:[e.jsx(ht,{data:v,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:v.map((a,N)=>e.jsx(pt,{fill:ut[N%ut.length]},`cell-${N}`))}),e.jsx(Be,{}),e.jsx(rs,{verticalAlign:"bottom",height:36})]})})})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:t("mdm.dashboard.deviceStatus")}),e.jsx("div",{className:"h-48",children:e.jsx(xe,{width:"100%",height:"100%",children:e.jsxs(xt,{children:[e.jsx(ht,{data:P,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:a,value:N})=>`${a}: ${N}`,children:P.map((a,N)=>e.jsx(pt,{fill:a.color},`cell-${N}`))}),e.jsx(Be,{})]})})}),e.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2 text-center",children:P.map(a=>e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-dark-700",children:[e.jsx("p",{className:"text-lg font-bold",style:{color:a.color},children:a.value}),e.jsx("p",{className:"text-xs text-slate-500",children:a.name})]},a.name))})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:t("mdm.dashboard.performanceTrends")}),e.jsx("div",{className:"h-40 md:h-48",children:e.jsx(xe,{width:"100%",height:"100%",children:e.jsxs(Me,{data:W,children:[e.jsx(ls,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-dark-600"}),e.jsx(is,{dataKey:"time",stroke:"#64748b",fontSize:12,interval:p?"preserveStartEnd":0}),e.jsx(ns,{stroke:"#64748b",fontSize:12}),e.jsx(Be,{}),e.jsx(fe,{type:"monotone",dataKey:"cpu",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.3,name:t("mdm.cpu")}),e.jsx(fe,{type:"monotone",dataKey:"memory",stackId:"1",stroke:"#8b5cf6",fill:"#8b5cf6",fillOpacity:.3,name:t("mdm.memory")})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:e.jsx(mt,{className:"w-5 h-5 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:t("mdm.dashboard.aiPredictions")}),e.jsx("p",{className:"text-sm text-slate-500",children:t("mdm.dashboard.aiPredictionsDesc")})]})]}),e.jsxs("span",{className:"text-sm text-slate-500",children:[t("mdm.dashboard.confidence"),": ",((L=r==null?void 0:r.summary)==null?void 0:L.averageConfidence)||0,"%"]})]}),(((G=r==null?void 0:r.summary)==null?void 0:G.criticalCount)||0)>0||(((X=r==null?void 0:r.summary)==null?void 0:X.highCount)||0)>0||(((q=r==null?void 0:r.atRiskDevices)==null?void 0:q.length)||0)>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:t("predictions.critical")}),e.jsx("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:((i=r==null?void 0:r.summary)==null?void 0:i.criticalCount)||0})]}),e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:t("predictions.high")}),e.jsx("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:((w=r==null?void 0:r.summary)==null?void 0:w.highCount)||0})]})]}),e.jsx("div",{className:"space-y-3",children:(M=r==null?void 0:r.atRiskDevices)==null?void 0:M.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-dark-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a.priority==="CRITICAL"?"bg-red-500":a.priority==="HIGH"?"bg-orange-500":"bg-yellow-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.deviceId}),e.jsx("p",{className:"text-xs text-slate-500",children:a.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:[a.confidence,"%"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[a.estimatedTimeToFailure,"d"]})]})]},a.predictionId))})]}):e.jsx("div",{className:"rounded-lg border border-slate-200 dark:border-dark-600 bg-slate-50 dark:bg-dark-700/40 px-3 py-2 text-xs text-slate-500",children:t("mdm.dashboard.noPredictions")})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(me,{className:"w-5 h-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:t("mdm.dashboard.maintenance")}),e.jsx("p",{className:"text-sm text-slate-500",children:t("mdm.dashboard.maintenanceDesc")})]})]}),e.jsx("button",{className:"text-sm text-primary-600 hover:underline",children:t("common.viewAll")})]}),e.jsx("div",{className:"space-y-3",children:((S=r==null?void 0:r.upcomingMaintenance)==null?void 0:S.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-dark-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${a.priority==="CRITICAL"?"bg-red-100 text-red-600":a.priority==="HIGH"?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"}`,children:e.jsx(me,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.deviceId}),e.jsx("p",{className:"text-xs text-slate-500",children:B(a.maintenanceType)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium",children:new Date(a.scheduledDate).toLocaleDateString()}),e.jsxs("p",{className:"text-xs text-slate-500",children:["$",a.estimatedCost]})]})]},a.scheduleId)))||e.jsx("p",{className:"text-center text-slate-500 py-8",children:t("mdm.dashboard.noMaintenance")})})]})]}),f&&Array.isArray(f)&&f.length>0&&e.jsxs("div",{className:"glass-panel p-6 border-l-4 border-red-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:t("mdm.dashboard.anomalies")})]}),e.jsxs("span",{className:"px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-full text-sm font-medium",children:[f.length," ",t("mdm.dashboard.devices")]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(Array.isArray(f)?f:[]).slice(0,6).map(a=>{var N;return e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-mono text-sm",children:a.deviceId}),e.jsxs("span",{className:"text-xs text-red-600",children:[Array.isArray(a.anomalies)?a.anomalies.length:0," ",t("mdm.issues")]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:Array.isArray(a.anomalies)&&((N=a.anomalies[0])==null?void 0:N.description)})]},a.deviceId)})})]})]})},Ns=()=>{const{t}=z(),[c]=Dt(),[d,x]=o.useState("devices"),[j,h]=o.useState(!1),[p,u]=o.useState([]),[n,D]=o.useState(!1),[r,m]=o.useState(!1),[f,y]=o.useState(null),[O,b]=o.useState(null),{confirm:C,dialogProps:v}=Nt(),[P,W]=o.useState(null),[V,H]=o.useState(null),[B,re]=o.useState(""),[K,J]=o.useState("all"),[L,G]=o.useState("all"),[X,q]=o.useState("all"),[i,w]=o.useState(!1),M=o.useRef(null),[S,a]=o.useState("all"),[N,I]=o.useState({visible:!1,x:0,y:0,deviceId:null}),[U,we]=o.useState(null),[ee,Ze]=o.useState(null),_=o.useRef(null),F=o.useRef(null),le=o.useRef(null),Ce=o.useRef(!1);o.useEffect(()=>{const s=()=>{N.visible&&(I(l=>({...l,visible:!1})),we(null))};return window.addEventListener("click",s),()=>window.removeEventListener("click",s)},[N.visible]),o.useEffect(()=>{p.length===0&&D(!1)},[p.length]);const{data:Oe,isLoading:At,isError:Je,error:et,refetch:It}=qe(),tt=zt(),st=Vt(),at=es({resolver:ts(us)}),De=s=>{if(!s)return"-";const l=s.match(/\d+/);return l?t("devices.routeLabel",{id:Number(l[0])}):s},rt=s=>{const l=new Date(s),g=new Date,A=g.getTime()-l.getTime(),T=60*1e3,$=60*T,ne=24*$;if(A<T)return t("devices.justNow");const R=Math.floor(A/T);if(R<60)return t("devices.minutesAgo",{count:R});const Ve=Math.floor(A/$),dt=l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(g.toDateString()===l.toDateString())return t("devices.todayAt",{time:dt});const ct=new Date(g);return ct.setDate(g.getDate()-1),ct.toDateString()===l.toDateString()?t("devices.yesterdayAt",{time:dt}):Ve<24?t("devices.hoursAgo",{count:Ve}):t("devices.daysAgo",{count:Math.floor(A/ne)})},Pe=s=>s==="OFFLINE"?"bg-red-700 dark:bg-red-600 text-white":s==="MAINTENANCE"?"bg-amber-600 dark:bg-amber-500 text-white":s==="ACTIVE"?"bg-emerald-600 dark:bg-emerald-500 text-white":"bg-slate-600 text-white",Te=s=>s==="ACTIVE"?t("common.statusTypes.ONLINE"):s==="OFFLINE"?t("common.statusTypes.OFFLINE"):s==="MAINTENANCE"?t("common.statusTypes.MAINTENANCE"):s,Se=s=>{const l=`common.types.${s.toUpperCase()}`,g=t(l);return g===l?s:g},_e=s=>{u(l=>l.includes(s)?l.filter(g=>g!==s):[...l,s])};o.useEffect(()=>{const s=c.get("status");(s==="offline"||s==="online"||s==="maintenance"||s==="all")&&a(s)},[c]);const We=(Oe==null?void 0:Oe.data)||[],lt=Array.from(new Set(We.map(s=>s.type))),it=Array.from(new Set(We.filter(s=>!!s.vehicleId).map(s=>De(s.vehicleId)))),E=We.filter(s=>{const l=["ONBOARD","VALIDATOR","TOPUP"].includes(s.type)&&(!!s.terminalId||!!s.vehicleId),g=K==="all"||l,A=K!=="terminal_business"||L==="all"||De(s.vehicleId)===L,T=!B||s.id.toLowerCase().includes(B.toLowerCase())||s.serialNumber.toLowerCase().includes(B.toLowerCase())||s.type.toLowerCase().includes(B.toLowerCase()),$=X==="all"||s.type===X,ne=S==="all"||S==="online"&&s.status==="ACTIVE"||S==="offline"&&s.status==="OFFLINE"||S==="maintenance"&&s.status==="MAINTENANCE";return g&&A&&T&&$&&ne}),Lt=()=>{var s;(s=M.current)==null||s.click()},Rt=s=>{var g;const l=(g=s.target.files)==null?void 0:g[0];l&&(y(null),b(t("devices.bulkImportSuccess",{file:l.name})),s.target.value="")},Et=()=>{if(E.length===0){y(t("devices.bulkExportEmpty"));return}const s=["id","type","serialNumber","terminalId","vehicleId","status","firmwareVersion","lastActivityAt"],l=R=>`"${(R==null?"":String(R)).replace(/"/g,'""')}"`,g=E.map(R=>[l(R.id),l(R.type),l(R.serialNumber),l(R.terminalId),l(R.vehicleId),l(R.status),l(R.firmwareVersion),l(R.lastActivityAt)]),A=[s.join(","),...g.map(R=>R.join(","))].join(`
`),T=new Blob([A],{type:"text/csv;charset=utf-8;"}),$=URL.createObjectURL(T),ne=document.createElement("a");ne.href=$,ne.download=`devices_${new Date().toISOString().slice(0,10)}.csv`,ne.click(),URL.revokeObjectURL($),b(t("devices.bulkExportSuccess",{count:E.length}))},ie=s=>{y(null),b(t("devices.bulkActionQueued",{action:t(`devices.bulkActions.${s}`),count:p.length}))},$t=Le(),ze=s=>{$t(`/devices/remote?id=${s}`)};o.useEffect(()=>{const s=g=>{const A=g.target;if(["INPUT","TEXTAREA"].includes(A.tagName))return;if(N.visible&&g.key==="Escape"){I($=>({...$,visible:!1}));return}if(!U)return;const T=g.key.toLowerCase();["d","r","l","backspace","delete"].includes(T)&&(g.preventDefault(),Ze(T),setTimeout(()=>{Ze(null),T==="d"?W(U):T==="r"?ze(U):T==="l"?H(U):(T==="backspace"||T==="delete")&&nt(U),I($=>({...$,visible:!1}))},150))},l=()=>I(g=>({...g,visible:!1}));return window.addEventListener("keydown",s),window.addEventListener("click",l),()=>{window.removeEventListener("keydown",s),window.removeEventListener("click",l)}},[U,N.visible]);const Y=i?"table-header-compact":"table-header",Q=i?"table-cell-compact":"table-cell",Ft=async s=>{var l,g;y(null);try{await tt.mutateAsync(s),h(!1),at.reset()}catch(A){y(((g=(l=A.response)==null?void 0:l.data)==null?void 0:g.message)||t("mdm.createDeviceError"))}},nt=async s=>{var g,A;if(await C({type:"danger",title:t("mdm.deleteDevice"),message:t("mdm.confirmDeleteDevice"),riskWarning:t("mdm.deleteDeviceWarning"),countdown:3})){y(null);try{await st.mutateAsync(s)}catch(T){y(((A=(g=T.response)==null?void 0:g.data)==null?void 0:A.message)||t("mdm.deleteDeviceError"))}}};return At?e.jsxs("div",{className:"space-y-4 overflow-x-hidden",children:[e.jsxs("div",{className:"hidden md:block glass-panel p-6",children:[e.jsx("div",{className:"h-10 w-72 rounded-lg bg-slate-100 dark:bg-dark-700 animate-pulse"}),e.jsx("div",{className:"mt-4 h-72 rounded-xl bg-slate-100 dark:bg-dark-700 animate-pulse"})]}),e.jsx("div",{className:"md:hidden space-y-3",children:Array.from({length:5}).map((s,l)=>e.jsxs("div",{className:"rounded-xl border border-slate-200 dark:border-dark-600 p-4 bg-white dark:bg-dark-700",children:[e.jsx("div",{className:"h-4 w-28 rounded bg-slate-100 dark:bg-dark-600 animate-pulse"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-12 rounded-lg bg-slate-100 dark:bg-dark-600 animate-pulse"}),e.jsx("div",{className:"h-12 rounded-lg bg-slate-100 dark:bg-dark-600 animate-pulse"})]}),e.jsx("div",{className:"mt-3 h-10 rounded-lg bg-slate-100 dark:bg-dark-600 animate-pulse"})]},`device-skeleton-${l}`))})]}):e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6 overflow-x-hidden",children:[f&&e.jsxs("div",{className:"p-4 bg-error/10 border border-error/20 rounded-lg flex items-center gap-3 text-error",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:f}),e.jsx("button",{onClick:()=>y(null),className:"ml-auto text-sm hover:underline",children:t("common.dismiss")})]}),O&&e.jsxs("div",{className:"p-4 bg-success/10 border border-success/20 rounded-lg flex items-center gap-3 text-success",children:[e.jsx(Bt,{className:"w-5 h-5"}),e.jsx("span",{children:O}),e.jsx("button",{onClick:()=>b(null),className:"ml-auto text-sm hover:underline",children:t("common.dismiss")})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-display font-semibold text-slate-900 dark:text-slate-100",children:t("devices.deviceList")})})}),e.jsxs("div",{className:"glass-panel overflow-hidden",children:[e.jsx("div",{className:"hidden md:flex gap-1 p-4 border-b border-slate-200 dark:border-dark-600 overflow-x-auto bg-slate-50 dark:bg-dark-800/50 scrollbar-hide snap-x",children:[{key:"all",label:t("mdm.filterAll"),count:E.length},{key:"online",label:t("mdm.filterOnline"),count:E.filter(s=>s.status==="ACTIVE").length},{key:"offline",label:t("mdm.filterOffline"),count:E.filter(s=>s.status==="OFFLINE").length},{key:"maintenance",label:t("mdm.filterMaintenance"),count:E.filter(s=>s.status==="MAINTENANCE").length}].map(s=>e.jsxs("button",{onClick:()=>a(s.key),className:`snap-start shrink-0 px-4 py-2 rounded-lg font-medium transition-all whitespace-nowrap flex items-center gap-2 active:scale-95 ${S===s.key?"bg-primary-500 text-white shadow-md":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200 hover:bg-slate-200 dark:hover:bg-dark-700"}`,children:[e.jsx("span",{children:s.label}),e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs ${S===s.key?"bg-white/20":"bg-slate-200 dark:bg-dark-600"}`,children:s.count})]},s.key))}),e.jsx("div",{className:"p-4 md:p-6",children:e.jsxs(Z,{mode:"wait",children:[d==="devices"&&e.jsxs(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-4",children:[Je&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 gap-4",children:[e.jsx(ae,{className:"w-12 h-12 text-error"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:et instanceof Error?et.message:t("common.loadError")}),e.jsxs("button",{onClick:()=>It(),className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),t("common.retry")]})]}),!Je&&E.length===0&&e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsx(ve,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:t("mdm.noDevices")})]}),e.jsxs("div",{className:"md:hidden flex items-center gap-2 mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>m(!0),"aria-label":t("mdm.searchDevices"),className:"min-h-11 flex-1 rounded-lg border border-slate-200 dark:border-dark-600 bg-white dark:bg-dark-700 px-3 flex items-center justify-center gap-2 text-slate-600 dark:text-slate-300",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:t("mdm.searchDevices")})]}),e.jsx("button",{type:"button",onClick:()=>m(!0),"aria-label":t("common.filter"),className:"w-11 min-h-11 rounded-lg border border-slate-200 dark:border-dark-600 bg-white dark:bg-dark-700 flex items-center justify-center",children:e.jsx(ds,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("div",{className:"hidden md:flex flex-wrap items-center gap-3 mb-4",children:[e.jsxs("select",{value:K,onChange:s=>{const l=s.target.value;J(l),l!=="terminal_business"&&G("all")},className:"px-4 py-2 bg-slate-100 dark:bg-dark-700 border border-slate-200 dark:border-dark-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:t("devices.viewAllDevices")}),e.jsx("option",{value:"terminal_business",children:t("devices.viewTerminalBusiness")})]}),e.jsxs("div",{className:"relative flex-1 min-w-[320px]",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:t("mdm.searchDevices"),value:B,onChange:s=>re(s.target.value),className:"input-field pl-10"})]}),K==="terminal_business"&&e.jsxs("select",{value:L,onChange:s=>G(s.target.value),className:"px-4 py-2 bg-slate-100 dark:bg-dark-700 border border-slate-200 dark:border-dark-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:t("devices.allRoutes")}),it.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:X,onChange:s=>q(s.target.value),className:"px-4 py-2 bg-slate-100 dark:bg-dark-700 border border-slate-200 dark:border-dark-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:t("common.allTypes")}),lt.map(s=>e.jsx("option",{value:s,children:Se(s)},s))]}),e.jsx("button",{onClick:()=>w(s=>!s),className:`px-3 py-2 rounded-lg text-sm font-medium border transition-colors ${i?"bg-primary-50 dark:bg-primary-500/10 text-primary-600 border-primary-200 dark:border-primary-500/30":"bg-transparent text-slate-600 dark:text-slate-400 border-slate-200 dark:border-dark-600 hover:bg-slate-50 dark:hover:bg-dark-700"}`,children:t("devices.compactMode")}),e.jsx("input",{ref:M,type:"file",accept:".csv,.xlsx",onChange:Rt,className:"hidden"}),e.jsxs("button",{type:"button",onClick:Lt,className:"px-3 py-2 rounded-lg text-sm font-medium border border-primary-200 dark:border-primary-500/30 text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-500/10 flex items-center gap-2",title:t("devices.bulkImportHint"),children:[e.jsx(Ke,{className:"w-4 h-4"}),t("devices.bulkImport")]}),e.jsxs("button",{type:"button",onClick:Et,className:"hidden sm:flex px-3 py-2 rounded-lg text-sm font-medium border border-slate-200 dark:border-dark-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-dark-700 items-center gap-2",title:t("devices.bulkExportHint"),children:[e.jsx(Ae,{className:"w-4 h-4"}),t("devices.bulkExport")]}),e.jsxs("button",{onClick:()=>h(!0),className:`hidden sm:flex btn-primary items-center gap-2 shadow-lg shadow-primary-500/30 hover:shadow-primary-500/50 hover:scale-[1.02] transition-transform relative ${E.length===0?"animate-pulse ring-4 ring-primary-500/20":""}`,children:[e.jsx(be,{className:"w-4 h-4"}),t("devices.addDevice"),E.length===0&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-primary-400 opacity-20 animate-ping pointer-events-none"})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full hidden md:table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-dark-600",children:[e.jsx("th",{className:Y,children:e.jsx("input",{type:"checkbox",checked:p.length===E.length&&E.length>0,onChange:s=>{s.target.checked?u(E.map(l=>l.id)):u([])},className:"rounded border-slate-300"})}),e.jsx("th",{className:Y,children:t("mdm.deviceId")}),e.jsx("th",{className:Y,children:t("mdm.deviceType")}),e.jsx("th",{className:Y,children:t("mdm.serialNumber")}),e.jsx("th",{className:Y,children:t("devices.linkedTerminalRoute")}),e.jsx("th",{className:Y,children:t("mdm.firmwareVersion")}),e.jsx("th",{className:Y,children:t("mdm.status")}),e.jsx("th",{className:Y,children:t("mdm.lastActivity")}),e.jsx("th",{className:`${Y} sticky right-0 bg-slate-50 dark:bg-dark-800 z-10 shadow-[-1px_0_0_0_rgba(0,0,0,0.1)]`,children:t("common.actions")})]})}),e.jsx("tbody",{"data-cursor":"list",className:"divide-y divide-slate-200 dark:divide-dark-600",children:E.map(s=>e.jsxs("tr",{onDoubleClick:()=>W(s.id),onClick:l=>{if(l.target.closest('input[type="checkbox"], button'))return;_.current&&clearTimeout(_.current),F.current&&clearTimeout(F.current),we(s.id);const g=l.currentTarget.getBoundingClientRect(),T=Math.min(l.clientX>0?l.clientX+20:g.left+50,window.innerWidth-240),$=g.top+g.height/2;I({visible:!0,x:T,y:$,deviceId:s.id})},onMouseEnter:l=>{we(s.id),_.current&&clearTimeout(_.current),F.current&&clearTimeout(F.current)},onMouseMove:l=>{if(!N.visible||N.deviceId!==s.id){_.current&&clearTimeout(_.current);const g=l.currentTarget.getBoundingClientRect(),T=Math.min(l.clientX+20,window.innerWidth-240),$=g.top+g.height/2;_.current=setTimeout(()=>{I({visible:!0,x:T,y:$,deviceId:s.id})},150)}},onMouseLeave:l=>{we(null),_.current&&clearTimeout(_.current),F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{I(g=>({...g,visible:!1}))},300)},onContextMenu:l=>{l.preventDefault(),_.current&&clearTimeout(_.current),F.current&&clearTimeout(F.current);const g=l.currentTarget.getBoundingClientRect(),T=Math.min(l.clientX+20,window.innerWidth-240);I({visible:!0,x:T,y:g.top+g.height/2,deviceId:s.id})},className:`group cursor-pointer transition-all relative ${U===s.id?"bg-[rgba(58,142,230,0.15)] shadow-[inset_4px_0_0_#00ffcc]":"hover:bg-[rgba(58,142,230,0.15)] hover:shadow-[inset_4px_0_0_#00ffcc]"}`,children:[e.jsx("td",{className:Q,children:e.jsx("input",{type:"checkbox",checked:p.includes(s.id),onChange:()=>_e(s.id),className:"rounded border-slate-300"})}),e.jsx("td",{className:`${Q} font-mono transition-colors ${U===s.id?"text-blue-500 font-bold":"text-primary-600"}`,children:s.id}),e.jsx("td",{className:Q,children:Se(s.type)}),e.jsx("td",{className:`${Q} font-mono`,children:s.serialNumber}),e.jsx("td",{className:Q,children:e.jsxs("div",{className:"leading-tight",children:[e.jsx("div",{className:"font-mono",children:s.terminalId||"-"}),e.jsx("div",{className:"text-slate-500",children:De(s.vehicleId)})]})}),e.jsx("td",{className:Q,children:s.firmwareVersion}),e.jsx("td",{className:Q,children:s.status==="ACTIVE"?e.jsxs("button",{onClick:l=>{l.stopPropagation(),ie("reboot")},className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold hover:ring-2 hover:ring-primary-500/30 transition-all ${Pe(s.status)}`,"data-cursor":"refresh",children:[e.jsx("span",{children:Te(s.status)}),e.jsx(Ee,{className:"w-3 h-3 opacity-60"})]}):s.status==="OFFLINE"?e.jsx("button",{type:"button",onClick:l=>{l.stopPropagation(),H(s.id)},title:t("devices.openOfflineLogs"),className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold hover:opacity-90 transition-opacity ${Pe(s.status)}`,children:Te(s.status)}):e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold ${Pe(s.status)}`,children:Te(s.status)})}),e.jsx("td",{className:`${Q} text-slate-500`,title:new Date(s.lastActivityAt).toLocaleString(),children:rt(s.lastActivityAt)}),e.jsx("td",{"data-cursor":"gear",className:`${Q} text-center`,onClick:l=>{l.stopPropagation(),_.current&&clearTimeout(_.current);const A=Math.min(l.clientX+10,window.innerWidth-240);I({visible:!0,x:A,y:l.clientY+10,deviceId:s.id})},children:e.jsx("button",{className:"p-2 text-slate-400 hover:text-primary-500 rounded-full hover:bg-slate-100 dark:hover:bg-dark-700 transition-colors",children:e.jsx(Ue,{className:"w-5 h-5"})})})]},s.id))})]}),e.jsx("div",{className:"md:hidden space-y-3 px-4 md:px-6",children:E.map(s=>e.jsxs("div",{onTouchStart:()=>{n||(Ce.current=!1,le.current&&clearTimeout(le.current),le.current=setTimeout(()=>{Ce.current=!0,D(!0),_e(s.id)},500))},onTouchEnd:()=>{le.current&&clearTimeout(le.current)},onTouchMove:()=>{le.current&&clearTimeout(le.current)},onClick:()=>{if(Ce.current){Ce.current=!1;return}if(n){_e(s.id);return}W(s.id)},className:`bg-white dark:bg-dark-700 rounded-xl p-4 shadow-sm border active:scale-[0.98] transition-all relative overflow-hidden flex flex-col gap-3 ${p.includes(s.id)?"border-primary-500 ring-2 ring-primary-500/20":"border-slate-200 dark:border-dark-600"}`,children:[n&&e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx("span",{className:`inline-flex items-center justify-center w-5 h-5 rounded-full border ${p.includes(s.id)?"bg-primary-600 border-primary-600 text-white":"bg-white border-slate-300 text-transparent"}`,children:e.jsx(Ye,{className:"w-3 h-3"})})}),e.jsxs("div",{className:`flex items-center justify-between gap-3 ${n?"pl-7":""}`,children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100 font-mono text-sm truncate",children:s.id}),e.jsx("span",{className:`shrink-0 inline-flex items-center px-2 py-1 rounded-md text-[10px] font-bold ${s.status==="ACTIVE"?"text-green-700 bg-green-100 dark:bg-green-500/20 dark:text-green-300":s.status==="OFFLINE"?"text-slate-600 bg-slate-100 dark:bg-slate-500/20 dark:text-slate-300":"text-orange-700 bg-orange-100 dark:bg-orange-500/20 dark:text-orange-300"}`,children:Te(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"rounded-lg bg-slate-50 dark:bg-dark-800 p-2.5",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:t("mdm.deviceType")}),e.jsx("p",{className:"font-medium text-slate-900 dark:text-slate-100 truncate",children:Se(s.type)})]}),e.jsxs("div",{className:"rounded-lg bg-slate-50 dark:bg-dark-800 p-2.5",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:t("mdm.firmwareVersion")}),e.jsx("p",{className:"font-mono text-slate-900 dark:text-slate-100 truncate",children:s.firmwareVersion||"-"})]})]}),e.jsxs("div",{className:"rounded-lg bg-slate-50 dark:bg-dark-800 p-2.5 space-y-1.5 text-[11px]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:t("mdm.serialNumber")}),e.jsx("span",{className:"font-mono text-slate-900 dark:text-slate-200 truncate max-w-[62%]",children:s.serialNumber||"-"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:t("devices.linkedTerminal")}),e.jsx("span",{className:"text-slate-900 dark:text-slate-200 truncate max-w-[62%]",children:s.terminalId?`${s.terminalId} / ${De(s.vehicleId)}`:"-"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-[10px] text-slate-500 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 min-w-0 truncate",children:[e.jsx(he,{className:"w-3 h-3 shrink-0"}),e.jsx("span",{className:"truncate",children:rt(s.lastActivityAt)})]}),!n&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:l=>{l.stopPropagation(),W(s.id)},className:"min-h-9 px-2 rounded-md border border-slate-200 dark:border-dark-600 text-slate-600 dark:text-slate-300",children:t("common.details")}),e.jsx("button",{type:"button",onClick:l=>{l.stopPropagation(),ze(s.id)},className:"min-h-9 px-2 rounded-md border border-slate-200 dark:border-dark-600 text-slate-600 dark:text-slate-300",children:t("devices.remote")}),e.jsx("button",{onClick:l=>{l.stopPropagation();const g=l.currentTarget.getBoundingClientRect();I({visible:!0,x:Math.max(8,g.right-240),y:g.top,deviceId:s.id})},"aria-label":t("common.actions"),className:"min-h-9 px-2 text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-dark-600 rounded border border-slate-200 dark:border-dark-600",children:e.jsx(Ue,{className:"w-4 h-4"})})]})]})]},s.id))})]}),Jt.createPortal(e.jsx(Z,{children:N.visible&&N.deviceId&&e.jsxs(k.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.2,ease:[.16,1,.3,1]},style:{position:"fixed",left:N.x,top:N.y,zIndex:9999},className:"flex flex-col px-2 py-2 bg-[rgba(20,20,25,0.95)] backdrop-blur-md rounded-xl shadow-[0_8px_32px_rgba(0,0,0,0.5)] border border-white/10 origin-center -translate-y-1/2",onClick:s=>s.stopPropagation(),onMouseEnter:()=>{F.current&&clearTimeout(F.current)},onMouseLeave:()=>{F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{I(s=>({...s,visible:!1}))},300)},children:[e.jsxs("div",{className:"text-[10px] text-slate-400 font-medium pb-2 mb-1 border-b border-white/10 px-1",children:[t("mdm.device"),": ",e.jsx("span",{className:"text-white font-mono",children:N.deviceId})]}),e.jsx("div",{className:"absolute left-0 top-8 bottom-2 w-[3px] bg-gradient-to-b from-primary-400 to-accent-500 rounded-r-sm"}),e.jsxs("div",{className:"flex items-center gap-1 pl-1",children:[e.jsxs("button",{onClick:()=>{W(N.deviceId),I(s=>({...s,visible:!1}))},className:`flex flex-col items-center justify-center w-14 py-2 rounded-lg relative group/btn transition-colors ${ee==="d"?"bg-blue-500/20":"hover:bg-white/5"}`,title:t("common.details"),children:[e.jsx(yt,{className:`w-5 h-5 mb-1 transition-colors ${ee==="d"?"text-blue-400":"text-slate-300 group-hover/btn:text-blue-400"}`}),e.jsx("span",{className:"text-[10px] text-slate-400 font-medium",children:t("common.details")}),e.jsx("kbd",{className:"absolute top-1 right-1 text-[8px] font-mono text-slate-500 bg-black/40 rounded px-1",children:"D"})]}),e.jsxs("button",{onClick:()=>{ze(N.deviceId),I(s=>({...s,visible:!1}))},className:`flex flex-col items-center justify-center w-14 py-2 rounded-lg relative group/btn transition-colors ${ee==="r"?"bg-amber-500/20":"hover:bg-white/5"}`,title:t("devices.remoteControl"),children:[e.jsx(Ne,{className:`w-5 h-5 mb-1 transition-colors ${ee==="r"?"text-amber-400":"text-slate-300 group-hover/btn:text-amber-400"}`}),e.jsx("span",{className:"text-[10px] text-slate-400 font-medium",children:t("devices.remoteControl")}),e.jsx("kbd",{className:"absolute top-1 right-1 text-[8px] font-mono text-slate-500 bg-black/40 rounded px-1",children:"R"})]}),e.jsxs("button",{onClick:()=>{H(N.deviceId),I(s=>({...s,visible:!1}))},className:`flex flex-col items-center justify-center w-14 py-2 rounded-lg relative group/btn transition-colors ${ee==="l"?"bg-emerald-500/20":"hover:bg-white/5"}`,title:t("devices.viewLogs"),children:[e.jsx(cs,{className:`w-5 h-5 mb-1 transition-colors ${ee==="l"?"text-emerald-400":"text-slate-300 group-hover/btn:text-emerald-400"}`}),e.jsx("span",{className:"text-[10px] text-slate-400 font-medium",children:t("devices.viewLogs")}),e.jsx("kbd",{className:"absolute top-1 right-1 text-[8px] font-mono text-slate-500 bg-black/40 rounded px-1",children:"L"})]}),e.jsx("div",{className:"w-[1px] h-8 mx-1 bg-white/10"}),e.jsxs("button",{onClick:()=>{nt(N.deviceId),I(s=>({...s,visible:!1}))},disabled:st.isPending,className:`flex flex-col items-center justify-center w-14 py-2 rounded-lg relative group/btn transition-colors disabled:opacity-50 ${["backspace","delete"].includes(ee||"")?"bg-rose-500/20":"hover:bg-rose-500/10"}`,title:t("common.delete"),children:[e.jsx(Mt,{className:`w-5 h-5 mb-1 transition-colors ${["backspace","delete"].includes(ee||"")?"text-rose-400":"text-slate-300 group-hover/btn:text-rose-500"}`}),e.jsx("span",{className:"text-[10px] text-slate-400 font-medium group-hover/btn:text-rose-400",children:t("common.delete")}),e.jsx("kbd",{className:"absolute top-1 right-1 text-[8px] font-mono text-slate-500 bg-black/40 rounded px-1",children:"âŒ«"})]})]})]})}),document.body),p.length>0&&e.jsxs("div",{className:"hidden md:flex flex-wrap items-center gap-4 p-4 bg-slate-50 dark:bg-dark-700 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:t("devices.bulkActionsLabel")}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:t("mdm.selectedDevices",{count:p.length})}),e.jsxs("div",{className:"flex gap-2 ml-auto flex-wrap",children:[e.jsxs("button",{className:"btn-secondary text-sm",onClick:()=>ie("command"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),t("devices.bulkActions.command")]}),e.jsxs("button",{className:"btn-secondary text-sm",onClick:()=>ie("upgrade"),children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),t("devices.bulkActions.upgrade")]}),e.jsxs("button",{className:"btn-secondary text-sm",onClick:()=>ie("reboot"),children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),t("devices.bulkActions.reboot")]}),e.jsxs("button",{className:"btn-secondary text-sm",onClick:()=>ie("status"),children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),t("devices.bulkActions.status")]})]})]}),e.jsx("button",{onClick:()=>h(!0),style:Fe,"aria-label":t("devices.addDevice"),className:`md:hidden fixed z-[80] right-6 w-14 h-14 bg-primary-600 hover:bg-primary-700 text-white rounded-full items-center justify-center shadow-lg shadow-primary-500/30 active:scale-95 transition-transform ${n?"hidden":"flex"}`,children:e.jsx(be,{className:"w-6 h-6"})}),n&&e.jsxs("div",{className:"md:hidden fixed left-4 right-4 z-[90] rounded-2xl bg-white/95 dark:bg-dark-800/95 border border-slate-200 dark:border-dark-600 shadow-xl p-3 flex items-center gap-2",style:{bottom:"calc(78px + env(safe-area-inset-bottom, 0px))"},children:[e.jsx("span",{className:"text-xs text-slate-500 shrink-0",children:t("mdm.selectedDevices",{count:p.length})}),e.jsx("button",{className:"btn-secondary text-xs px-3 py-2",onClick:()=>ie("reboot"),children:t("devices.bulkActions.reboot")}),e.jsx("button",{className:"btn-secondary text-xs px-3 py-2",onClick:()=>ie("upgrade"),children:t("devices.bulkActions.upgrade")}),e.jsx("button",{className:"ml-auto text-xs text-slate-500 hover:text-slate-700 dark:hover:text-slate-200",onClick:()=>u([]),children:t("common.cancel")})]})]},"devices"),d!=="devices"&&e.jsxs(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"text-center py-12 text-slate-500",children:[e.jsx(he,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:t("common.comingSoon")}),e.jsx("p",{className:"text-sm mt-2",children:t("devices.tabInDevelopment",{tab:d})})]},d)]})})]}),e.jsx(Z,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"md:hidden fixed inset-0 bg-black/40 z-[70]",onClick:()=>m(!1)}),e.jsxs(k.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:26,stiffness:220},className:"md:hidden fixed inset-0 z-[80] bg-white dark:bg-dark-800 p-4 flex flex-col",style:{paddingBottom:"calc(1rem + env(safe-area-inset-bottom, 0px))"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:t("common.filter")}),e.jsx("button",{className:"p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-dark-700",onClick:()=>m(!1),"aria-label":t("common.close"),children:e.jsx(ke,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:t("mdm.searchDevices"),value:B,onChange:s=>re(s.target.value),className:"input-field pl-10"})]}),e.jsxs("select",{value:K,onChange:s=>{const l=s.target.value;J(l),l!=="terminal_business"&&G("all")},className:"input-field",children:[e.jsx("option",{value:"all",children:t("devices.viewAllDevices")}),e.jsx("option",{value:"terminal_business",children:t("devices.viewTerminalBusiness")})]}),K==="terminal_business"&&e.jsxs("select",{value:L,onChange:s=>G(s.target.value),className:"input-field",children:[e.jsx("option",{value:"all",children:t("devices.allRoutes")}),it.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:X,onChange:s=>q(s.target.value),className:"input-field",children:[e.jsx("option",{value:"all",children:t("common.allTypes")}),lt.map(s=>e.jsx("option",{value:s,children:Se(s)},s))]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{key:"all",label:t("mdm.filterAll")},{key:"online",label:t("mdm.filterOnline")},{key:"offline",label:t("mdm.filterOffline")},{key:"maintenance",label:t("mdm.filterMaintenance")}].map(s=>e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm border ${S===s.key?"bg-primary-600 border-primary-600 text-white":"bg-slate-50 dark:bg-dark-700 border-slate-200 dark:border-dark-600"}`,onClick:()=>a(s.key),children:s.label},s.key))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4 pt-3 border-t border-slate-200 dark:border-dark-600",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>{J("all"),G("all"),q("all"),a("all")},children:t("common.reset")}),e.jsx("button",{className:"btn-primary",onClick:()=>m(!1),children:t("common.confirm")})]})]})]})}),j&&e.jsx(gs,{onClose:()=>h(!1),onSubmit:Ft,isSubmitting:tt.isPending,methods:at}),P&&e.jsx(fs,{deviceId:P,onClose:()=>W(null)}),V&&e.jsx(js,{deviceId:V,onClose:()=>H(null)}),e.jsx(kt,{...v})]})},ys=()=>{var D,r;const{t}=z(),{data:c}=ft(),{data:d}=Xe(!0),{data:x}=vt(),{data:j}=wt(),[h,p]=o.useState({communication:{signal4G:-65+Math.floor(Math.random()*20),wifiLatency:15+Math.floor(Math.random()*30),simTraffic:2.5+Math.random()*2},hardware:{flashWrites:85+Math.floor(Math.random()*10),voltage:11.8+Math.random()*.5,temperature:35+Math.floor(Math.random()*15)},peripherals:{cardReader:Math.random()>.1,display:Math.random()>.05,speaker:Math.random()>.1,printer:Math.random()>.2}});o.useEffect(()=>{const m=setInterval(()=>{p({communication:{signal4G:-65+Math.floor(Math.random()*20),wifiLatency:15+Math.floor(Math.random()*30),simTraffic:2.5+Math.random()*2},hardware:{flashWrites:85+Math.floor(Math.random()*10),voltage:11.8+Math.random()*.5,temperature:35+Math.floor(Math.random()*15)},peripherals:{cardReader:Math.random()>.1,display:Math.random()>.05,speaker:Math.random()>.1,printer:Math.random()>.2}})},5e3);return()=>clearInterval(m)},[]);const u=m=>m>-60?"text-green-500":m>-75?"text-yellow-500":"text-red-500",n=m=>m>12?"text-green-500":m>11.5?"text-yellow-500":"text-red-500";return e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("devices.health")}),e.jsx("p",{className:"hidden md:block text-slate-500 dark:text-slate-400 mt-1",children:t("devices.healthSubtitle")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:t("maintenance.critical"),value:((D=d==null?void 0:d.summary)==null?void 0:D.criticalCount)||0,icon:ue,color:"red"},{label:t("maintenance.highPriority"),value:((r=d==null?void 0:d.summary)==null?void 0:r.highCount)||0,icon:Kt,color:"orange"},{label:t("maintenance.scheduled"),value:(j==null?void 0:j.length)||0,icon:he,color:"blue"},{label:t("maintenance.anomalies"),value:(x==null?void 0:x.length)||0,icon:se,color:"amber"}].map((m,f)=>{var y,O,b;return e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:f*.1},className:"stat-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:m.label}),e.jsx("p",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100 mt-2",children:m.value})]}),e.jsx("div",{className:`p-3 rounded-lg ${((y=ce[m.color])==null?void 0:y.bg)??"bg-slate-500/10"}`,children:e.jsx(m.icon,{className:`w-6 h-6 ${((O=ce[m.color])==null?void 0:O.text)??"text-slate-500"} ${((b=ce[m.color])==null?void 0:b.textDark)??""}`})})]})},m.label)})}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(St,{className:"w-5 h-5 text-blue-500"}),t("mdm.health.communication")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700 rounded-xl",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:t("mdm.health.signal4G")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`text-2xl font-bold ${u(h.communication.signal4G)}`,children:[h.communication.signal4G," dBm"]}),e.jsx("span",{className:`w-2.5 h-2.5 rounded-full animate-pulse ${h.communication.signal4G>-60?"bg-green-500 shadow-[0_0_6px_rgba(34,197,94,0.6)]":h.communication.signal4G>-75?"bg-yellow-500 shadow-[0_0_6px_rgba(234,179,8,0.6)]":"bg-red-500 shadow-[0_0_6px_rgba(239,68,68,0.6)]"}`})]}),e.jsx("div",{className:"flex items-end gap-1 mt-2",children:[1,2,3,4,5].map(m=>{const f=h.communication.signal4G>-50-m*10,y=m===5&&f;return e.jsx("div",{style:{height:`${(m+1)*4}px`},className:`w-2 rounded transition-all duration-500 ${f?`bg-green-500 ${y?"animate-pulse shadow-[0_0_4px_rgba(34,197,94,0.5)]":""}`:"bg-slate-300 dark:bg-dark-600"}`},m)})})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700 rounded-xl",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:t("mdm.health.wifiLatency")}),e.jsxs("p",{className:`text-2xl font-bold ${h.communication.wifiLatency<30?"text-green-500":"text-yellow-500"}`,children:[h.communication.wifiLatency," ms"]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700 rounded-xl",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:t("mdm.health.simTraffic")}),e.jsxs("p",{className:"text-2xl font-bold text-blue-500",children:[h.communication.simTraffic.toFixed(1)," GB"]})]})]})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-purple-500"}),t("mdm.health.hardwareLifecycle")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700 rounded-xl",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:t("mdm.health.flashWrites")}),e.jsxs("p",{className:`text-2xl font-bold ${h.hardware.flashWrites>90?"text-red-500":"text-green-500"}`,children:[h.hardware.flashWrites,"%"]}),e.jsx("div",{className:"h-2 bg-slate-200 dark:bg-dark-600 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:`h-full ${h.hardware.flashWrites>90?"bg-red-500":"bg-green-500"}`,style:{width:`${h.hardware.flashWrites}%`}})})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700 rounded-xl",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:t("mdm.health.voltage")}),e.jsxs("p",{className:`text-2xl font-bold ${n(h.hardware.voltage)}`,children:[h.hardware.voltage.toFixed(1)," V"]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700 rounded-xl",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:t("mdm.health.temperature")}),e.jsxs("p",{className:`text-2xl font-bold ${h.hardware.temperature>50?"text-red-500":"text-green-500"}`,children:[h.hardware.temperature,"Â°C"]})]})]})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-cyan-500"}),t("mdm.health.peripherals")]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{name:t("mdm.health.cardReader"),status:h.peripherals.cardReader,icon:Ut},{name:t("mdm.health.display"),status:h.peripherals.display,icon:Ht},{name:t("mdm.health.speaker"),status:h.peripherals.speaker,icon:xs},{name:t("mdm.health.printer"),status:h.peripherals.printer,icon:os}].map(m=>e.jsx("div",{className:`p-4 rounded-xl border-2 ${m.status?"border-green-500 bg-green-50 dark:bg-green-950/20":"border-red-500 bg-red-50 dark:bg-red-950/20"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m.icon,{className:`w-6 h-6 ${m.status?"text-green-500":"text-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.name}),e.jsx("p",{className:`text-sm ${m.status?"text-green-600":"text-red-600"}`,children:m.status?t("common.online"):t("common.offline")})]})]})},m.name))})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:t("maintenance.fleetHealth")}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:t("maintenance.averageScore")}),e.jsxs("span",{className:"text-2xl font-bold",children:[c.averageScore,"/100"]})]}),e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-dark-600 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500",style:{width:`${c.averageScore}%`}})})]})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-indigo-500"}),t("mdm.resourceMonitoring.resourceUsage")]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-dark-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:t("mdm.resourceMonitoring.cpu")}),e.jsxs("span",{className:"text-lg font-bold text-indigo-600",children:[h.hardware.temperature,"%"]})]}),e.jsx(xe,{width:"100%",height:100,children:e.jsx(Me,{data:Array.from({length:20},(m,f)=>({time:f,value:30+Math.random()*40})),children:e.jsx(fe,{type:"monotone",dataKey:"value",stroke:"#6366f1",fill:"#6366f1",fillOpacity:.2})})})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-dark-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:t("mdm.resourceMonitoring.memory")}),e.jsx("span",{className:"text-lg font-bold text-emerald-600",children:"62%"})]}),e.jsx(xe,{width:"100%",height:100,children:e.jsx(Me,{data:Array.from({length:20},(m,f)=>({time:f,value:50+Math.random()*30})),children:e.jsx(fe,{type:"monotone",dataKey:"value",stroke:"#10b981",fill:"#10b981",fillOpacity:.2})})})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-dark-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:t("mdm.resourceMonitoring.storage")}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:[h.hardware.flashWrites,"%"]})]}),e.jsx(xe,{width:"100%",height:100,children:e.jsx(Me,{data:Array.from({length:20},(m,f)=>({time:f,value:40+Math.random()*20})),children:e.jsx(fe,{type:"monotone",dataKey:"value",stroke:"#f59e0b",fill:"#f59e0b",fillOpacity:.2})})})]})]})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-yellow-500"}),t("mdm.resourceMonitoring.environment")]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700/50 rounded-xl text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:t("mdm.health.temperature")}),e.jsxs("p",{className:`text-2xl font-bold ${h.hardware.temperature>70?"text-red-500":"text-green-500"}`,children:[h.hardware.temperature,"Â°C"]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700/50 rounded-xl text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:t("mdm.health.voltage")}),e.jsxs("p",{className:`text-2xl font-bold ${h.hardware.voltage<4.5?"text-amber-500":"text-green-500"}`,children:[h.hardware.voltage,"V"]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700/50 rounded-xl text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:t("mdm.resourceMonitoring.humidity")}),e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:"45%"})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-dark-700/50 rounded-xl text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-1",children:t("mdm.resourceMonitoring.uptime")}),e.jsx("p",{className:"text-2xl font-bold text-purple-500",children:"72h"})]})]})]})]})},ks=()=>{const{t}=z(),{data:c,isLoading:d}=Gt(),x=Array.isArray(c)?c:[],{data:j}=jt(),h=Array.isArray(j)?j:[],[p,u]=o.useState(!1),[n,D]=o.useState(null),[r,m]=o.useState(!1),[f,y]=o.useState({targetPercentage:5,routeFilter:"",deviceIds:"",silentUpgrade:!0,upgradeWindow:"02:00-04:00",autoRollback:!0});if(d)return e.jsx("div",{className:"flex justify-center p-12",children:e.jsx(pe,{className:"animate-spin"})});const O=()=>{u(!1)};return e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("devices.firmware")}),e.jsx("p",{className:"hidden md:block text-slate-500 dark:text-slate-400 mt-1",children:t("devices.firmwareSubtitle")})]}),e.jsxs("button",{className:"hidden md:flex btn-primary items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),t("mdm.addVersion")]})]}),e.jsxs("div",{className:"flex overflow-x-auto gap-3 md:gap-4 pb-2 snap-x scrollbar-hide md:grid md:grid-cols-3",children:[e.jsx("button",{type:"button",onClick:()=>{D(x[0]||null),u(!0)},className:"glass-panel p-3 md:p-4 shrink-0 snap-start w-[200px] md:w-auto active:scale-95 transition-transform cursor-pointer text-start",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-2 md:gap-3 md:mb-2 text-center md:text-left",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg shrink-0",children:e.jsx(je,{className:"w-4 h-4 md:w-5 md:h-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm md:text-base leading-tight",children:t("mdm.firmware.canaryRelease")}),e.jsx("p",{className:"hidden md:block text-xs text-slate-500",children:t("mdm.firmware.canaryDesc")})]})]})}),e.jsx("button",{type:"button",onClick:()=>{y(b=>({...b,silentUpgrade:!0})),D(x[0]||null),u(!0)},className:"glass-panel p-3 md:p-4 shrink-0 snap-start w-[200px] md:w-auto active:scale-95 transition-transform cursor-pointer text-start",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-2 md:gap-3 md:mb-2 text-center md:text-left",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg shrink-0",children:e.jsx(he,{className:"w-4 h-4 md:w-5 md:h-5 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm md:text-base leading-tight",children:t("mdm.firmware.silentUpgrade")}),e.jsx("p",{className:"hidden md:block text-xs text-slate-500",children:t("mdm.firmware.silentDesc")})]})]})}),e.jsx("button",{type:"button",onClick:()=>{y(b=>({...b,autoRollback:!0})),D(x[0]||null),u(!0)},className:"glass-panel p-3 md:p-4 shrink-0 snap-start w-[200px] md:w-auto active:scale-95 transition-transform cursor-pointer text-start",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-2 md:gap-3 md:mb-2 text-center md:text-left",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg shrink-0",children:e.jsx(Ie,{className:"w-4 h-4 md:w-5 md:h-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm md:text-base leading-tight",children:t("mdm.firmware.autoRollback")}),e.jsx("p",{className:"hidden md:block text-xs text-slate-500",children:t("mdm.firmware.rollbackDesc")})]})]})})]}),h.length>0&&e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-500"}),t("mdm.firmware.activeCanary")]}),e.jsx("div",{className:"space-y-3",children:h.map(b=>{var C;return e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-dark-700 rounded-xl",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsxs("span",{className:"text-slate-400 font-mono text-sm",children:["v",(parseFloat(((C=b.firmwareVersion)==null?void 0:C.replace("v",""))||"0")-.01).toFixed(2)]}),e.jsx(gt,{className:"w-4 h-4 text-primary-500"}),e.jsx("span",{className:"font-mono font-bold text-lg text-primary-600 dark:text-primary-400",children:b.firmwareVersion}),e.jsx("span",{className:`badge ${b.status==="IN_PROGRESS"?"badge-success":"badge-warning"} text-[10px] px-1.5 py-0.5`,children:b.status})]}),e.jsxs("div",{className:"text-sm text-slate-500 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-slate-400 mr-2"}),b.currentPercentage,"% ",t("mdm.firmware.deployed")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${b.healthCriteria.minHealthScore>=80?"bg-green-500":"bg-orange-500"} mr-1`}),e.jsxs("span",{className:b.healthCriteria.minHealthScore>=80?"text-green-600 dark:text-green-400":"text-orange-600 dark:text-orange-400",children:[t("mdm.firmware.healthScore"),": ",b.healthCriteria.minHealthScore,"/100"]})]})]})]}),e.jsxs("div",{className:"relative w-14 h-14 flex items-center justify-center shrink-0",children:[e.jsxs("svg",{className:"w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"28",cy:"28",r:"24",stroke:"currentColor",strokeWidth:"6",fill:"none",className:"text-slate-200 dark:text-dark-600"}),e.jsx("circle",{cx:"28",cy:"28",r:"24",stroke:"currentColor",strokeWidth:"6",fill:"transparent",strokeDasharray:"150.7",strokeDashoffset:150.7*(1-(b.currentPercentage||0)/100),className:"text-blue-500 transition-all duration-1000 ease-out",strokeLinecap:"round"})]}),e.jsxs("span",{className:"absolute text-[11px] font-bold",children:[b.currentPercentage,"%"]})]})]})},b.deploymentId)})})]}),(()=>{const b=r?x:x.slice(0,2);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(C=>{var v;return e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg text-blue-500",children:e.jsx($e,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-slate-100",children:C.version}),e.jsx("p",{className:"text-xs text-slate-500",children:C.releaseDate})]})]}),e.jsx("span",{className:`badge ${C.type==="STABLE"?"badge-success":"badge-warning"}`,children:C.type})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:t("mdm.fileSize")}),e.jsx("span",{className:"font-medium",children:C.size})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:t("mdm.checksum")}),e.jsxs("span",{className:"font-mono text-xs",children:[(v=C.checksum)==null?void 0:v.slice(0,12),"..."]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 btn-secondary text-sm py-1.5",children:t("common.details")}),e.jsxs("button",{className:"flex-1 btn-primary text-sm py-1.5 flex items-center justify-center gap-2",onClick:()=>{D(C),u(!0)},children:[e.jsx(je,{className:"w-3.5 h-3.5"}),t("mdm.firmware.startCanary")]})]})]},C.version)})}),x.length>2&&!r&&e.jsxs("button",{onClick:()=>m(!0),className:"w-full py-3 mt-4 text-sm font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-500/10 hover:bg-primary-100 dark:hover:bg-primary-500/20 rounded-xl transition-colors flex items-center justify-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),t("common.showMore")," (",x.length-2,")"]})]})})(),e.jsx(Z,{children:p&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-[70]",onClick:()=>u(!1)}),e.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 flex items-end md:items-center justify-center z-[80] p-0 md:p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-t-2xl md:rounded-2xl p-6 max-w-lg w-full shadow-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-blue-500"}),t("mdm.firmware.canaryConfig")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.firmware.targetVersion")}),e.jsx("input",{type:"text",value:(n==null?void 0:n.version)||"",disabled:!0,className:"input-field mt-1 bg-slate-100 dark:bg-dark-700"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.firmware.canaryPercentage")}),e.jsx("input",{type:"range",min:"1",max:"100",value:f.targetPercentage,onChange:b=>y({...f,targetPercentage:+b.target.value}),className:"w-full mt-1"}),e.jsxs("p",{className:"text-sm text-slate-500",children:[f.targetPercentage,"% ",t("mdm.firmware.ofDevices")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.firmware.upgradeWindow")}),e.jsx("input",{type:"text",value:f.upgradeWindow,onChange:b=>y({...f,upgradeWindow:b.target.value}),className:"input-field mt-1",placeholder:"02:00-04:00"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:f.silentUpgrade,onChange:b=>y({...f,silentUpgrade:b.target.checked})}),e.jsx("span",{className:"text-sm",children:t("mdm.firmware.silentUpgrade")})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:f.autoRollback,onChange:b=>y({...f,autoRollback:b.target.checked})}),e.jsx("span",{className:"text-sm",children:t("mdm.firmware.autoRollback")})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{className:"flex-1 btn-secondary",onClick:()=>u(!1),children:t("common.cancel")}),e.jsx("button",{className:"flex-1 btn-primary",onClick:O,children:t("mdm.firmware.startDeployment")})]})]})})]})}),e.jsx("button",{className:"md:hidden fixed z-[80] right-6 w-14 h-14 bg-primary-600 hover:bg-primary-700 text-white rounded-full flex items-center justify-center shadow-lg shadow-primary-500/30 active:scale-95 transition-transform",style:Fe,"aria-label":t("mdm.firmware.startCanary"),onClick:()=>{D(x[0]||null),u(!0)},children:e.jsx(be,{className:"w-6 h-6"})})]})},ws=()=>{const{t}=z(),[c]=Dt(),d=c.get("id")||"",{data:x}=qe(),j=Xt(),{confirm:h,dialogProps:p}=Nt(),[u,n]=o.useState(d),[D,r]=o.useState(null);o.useEffect(()=>{const v=c.get("id");v&&n(v)},[c]);const m=((x==null?void 0:x.data)||[]).slice(0,6).map(v=>v.id),[f,y]=o.useState({heartbeatInterval:30,logLevel:"INFO",blacklistSyncInterval:60}),O=async v=>{if(u){r(v);try{await j.mutateAsync({id:u,command:v})}catch(P){console.error(P)}finally{r(null)}}},b=()=>{r("CONFIG"),setTimeout(()=>r(null),800)},C=[{cmd:"REBOOT",label:t("mdm.cmdRestart"),icon:Ie,color:"red",danger:!0},{cmd:"LOG_TRANSFER",label:t("mdm.cmdCheckHealth"),icon:Qe,color:"blue"},{cmd:"WAKE_UP",label:t("mdm.cmdSyncTime"),icon:Re,color:"amber"},{cmd:"CLEAR_CACHE",label:t("mdm.cmdClearCache"),icon:Mt,color:"purple"},{cmd:"SCREENSHOT",label:t("mdm.cmdScreenshot"),icon:yt,color:"cyan"},{cmd:"LOCK_DEVICE",label:t("mdm.cmdLockDevice"),icon:qt,color:"slate",danger:!0}];return e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("devices.remote")}),e.jsx("p",{className:"hidden md:block text-slate-500 dark:text-slate-400 mt-1",children:t("devices.remoteSubtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-6 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary-500"}),t("mdm.sendCommand")]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:t("mdm.deviceId")}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",value:u,onChange:v=>n(v.target.value),placeholder:t("devices.enterDeviceIdHint"),className:`input-field pl-10 w-full bg-slate-50 dark:bg-dark-700 focus:bg-white dark:focus:bg-dark-800 ${u?"":"ring-2 ring-amber-500/20 border-amber-500"}`})]})}),m.length>0&&e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:t("mdm.online")}),m.map(v=>e.jsx("button",{type:"button",onClick:()=>n(v),className:"px-2.5 py-1 rounded-full text-xs bg-slate-100 dark:bg-dark-700 hover:bg-slate-200 dark:hover:bg-dark-600",children:v},v))]}),!u&&e.jsxs("p",{className:"mt-2 text-sm text-amber-600 flex items-center gap-1 animate-pulse",children:[e.jsx(ae,{className:"w-4 h-4"}),t("devices.selectDeviceFirst")]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 md:gap-4",children:C.map(v=>{const P=ce[v.color]??ce.slate;return e.jsxs("button",{disabled:!u||j.isPending||!!D,onClick:async()=>{v.danger&&!await h({type:"danger",title:t("mdm.sendCommand"),message:`${v.label} Â· ${u}`,riskWarning:t("devices.remoteDangerHint"),countdown:3})||await O(v.cmd)},className:`p-3 md:p-4 rounded-xl border transition-all text-center group disabled:opacity-50 ${v.danger?"border-red-200 dark:border-red-900/50 hover:border-red-500 bg-red-50/30 dark:bg-red-900/10":"border-slate-200 dark:border-dark-600 hover:border-primary-500 dark:hover:border-primary-500 bg-slate-50 dark:bg-dark-700/50"}`,children:[e.jsx("div",{className:`w-8 h-8 md:w-10 md:h-10 mx-auto rounded-lg ${P.bg} flex items-center justify-center mb-2 md:mb-3 group-hover:scale-110 transition-transform`,children:e.jsx(v.icon,{className:`w-4 h-4 md:w-5 md:h-5 ${P.text} ${v.danger?"animate-pulse":""}`})}),e.jsx("span",{className:`font-medium text-[11px] md:text-sm ${v.danger?"text-red-700 dark:text-red-400":"text-slate-900 dark:text-slate-100"}`,children:v.label}),D===v.cmd&&e.jsx("span",{className:"block text-[10px] mt-1 text-primary-500 animate-pulse",children:t("mdm.send")})]},v.cmd)})}),j.isSuccess&&e.jsx("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-600 text-sm",children:t("common.saveSuccess")})]})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-purple-500"}),t("mdm.remote.hotConfig")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.remote.heartbeatInterval")}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"number",value:f.heartbeatInterval,onChange:v=>y({...f,heartbeatInterval:+v.target.value}),className:"input-field w-20"}),e.jsx("span",{className:"text-sm text-slate-500",children:t("time.second")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.remote.logLevel")}),e.jsxs("select",{value:f.logLevel,onChange:v=>y({...f,logLevel:v.target.value}),className:"input-field mt-1",children:[e.jsx("option",{value:"DEBUG",children:"DEBUG"}),e.jsx("option",{value:"INFO",children:"INFO"}),e.jsx("option",{value:"WARN",children:"WARN"}),e.jsx("option",{value:"ERROR",children:"ERROR"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.remote.blacklistSync")}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"number",value:f.blacklistSyncInterval,onChange:v=>y({...f,blacklistSyncInterval:+v.target.value}),className:"input-field w-20"}),e.jsx("span",{className:"text-sm text-slate-500",children:t("time.second")})]})]}),e.jsx("button",{className:"w-full btn-primary mt-4",disabled:!u,onClick:b,children:t("mdm.remote.applyConfig")})]})]})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-slate-500"}),t("mdm.commandHistory")]}),e.jsx("div",{className:"text-center py-8 text-slate-500",children:e.jsx("p",{className:"text-sm",children:t("common.comingSoon")})})]}),e.jsx(kt,{...p})]})},Cs=()=>{const{t}=z(),c=Le(),{data:d,isLoading:x}=Xe(!0),{data:j}=wt(),h=p=>t(`mdm.maintenanceTypes.${p.toLowerCase()}`);return x?e.jsx("div",{className:"flex justify-center p-12",children:e.jsx(pe,{className:"animate-spin"})}):e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("devices.maintenance")}),e.jsx("p",{className:"hidden md:block text-slate-500 dark:text-slate-400 mt-1",children:t("devices.maintenanceSubtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[(d==null?void 0:d.atRiskDevices)&&d.atRiskDevices.length>0&&e.jsxs("div",{className:"space-y-3 lg:col-span-2",children:[e.jsxs("h3",{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-red-500"}),t("mdm.dashboard.aiPredictions")]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:d.atRiskDevices.map(p=>e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/50 rounded-xl flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-mono text-sm font-bold text-red-700 dark:text-red-400",children:p.deviceId}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${p.priority==="CRITICAL"?"bg-red-500 text-white":"bg-orange-500 text-white"}`,children:p.priority})]}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-300 line-clamp-2",children:p.description}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] mt-1",children:[e.jsxs("span",{className:"text-red-400 dark:text-red-500",children:[t("mdm.dashboard.confidence"),": ",p.confidence,"%"]}),e.jsxs("span",{className:"font-medium text-red-700 dark:text-red-400",children:["ETA ",p.estimatedTimeToFailure,"d"]})]})]},p.predictionId))})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-6 lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 md:mb-6",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(me,{className:"w-5 h-5 text-amber-500"})}),e.jsx("h3",{className:"text-base md:text-lg font-semibold",children:t("mdm.dashboard.maintenance")})]}),e.jsx("div",{className:"space-y-3 md:space-y-4",children:j==null?void 0:j.map(p=>{const u=new Date(p.scheduledDate),n=p.estimatedCost>500;return e.jsxs("div",{className:"flex gap-3 md:gap-4 p-3 md:p-4 bg-slate-50 dark:bg-dark-700/30 hover:bg-slate-100 dark:hover:bg-dark-700 transition-colors rounded-xl border border-transparent hover:border-slate-200 dark:hover:border-dark-600 group",children:[e.jsxs("div",{className:"flex-shrink-0 w-12 md:w-14 bg-white dark:bg-dark-800 rounded-lg flex flex-col items-center justify-center border border-slate-200 dark:border-dark-600 shadow-sm overflow-hidden h-14 md:h-16",children:[e.jsx("div",{className:"bg-amber-500 w-full text-center text-[8px] md:text-[10px] font-bold text-white uppercase py-0.5",children:u.toLocaleString("default",{month:"short"})}),e.jsx("div",{className:"text-lg md:text-xl font-bold text-slate-700 dark:text-slate-300 mt-0.5",children:u.getDate()})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-900 dark:text-slate-100 truncate",children:p.deviceId}),e.jsx("p",{className:"text-xs text-slate-500 truncate mt-0.5",children:h(p.maintenanceType)}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5 text-xs",children:[e.jsxs("span",{className:`px-1.5 py-0.5 rounded font-mono font-medium ${n?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:["$",p.estimatedCost]}),e.jsx("span",{className:"text-slate-400 truncate hidden sm:inline-block hover:text-slate-600 transition-colors",children:p.assignedTo||"-"})]})]}),e.jsx("div",{className:"hidden sm:flex items-center justify-end opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{className:"p-2 text-slate-400 hover:text-amber-500 rounded-full hover:bg-amber-50 dark:hover:bg-amber-500/10",children:e.jsx(Ue,{className:"w-5 h-5"})})})]},p.scheduleId)})})]})]}),e.jsx("button",{className:"md:hidden fixed z-[80] right-6 w-14 h-14 bg-amber-600 hover:bg-amber-700 text-white rounded-full flex items-center justify-center shadow-lg shadow-amber-500/30 active:scale-95 transition-transform",style:Fe,"aria-label":t("maintenance.createTicket"),onClick:()=>c("/devices/remote"),children:e.jsx(be,{className:"w-6 h-6"})})]})},Ds=()=>{var q;const{t}=z(),{data:c,isLoading:d}=Ct({}),[x,j]=o.useState("ALL"),[h,p]=o.useState(""),[u,n]=o.useState(!1),[D,r]=o.useState(20),[m,f]=o.useState(null),[y,O]=o.useState(""),[b,C]=o.useState("all"),[v,P]=o.useState(!1),W=o.useRef(null);o.useRef(null);const[V,H]=o.useState({startTime:"",endTime:"",levels:["ERROR","WARN","INFO"],maxLines:1e3}),B=["ALL","ERROR","WARN","INFO","DEBUG"],re={ERROR:"bg-red-500",WARN:"bg-amber-500",INFO:"bg-emerald-500",DEBUG:"bg-slate-400",FATAL:"bg-red-700"},K={ERROR:"bg-red-500 text-white",WARN:"bg-amber-500 text-white",INFO:"bg-emerald-500 text-white",DEBUG:"bg-slate-500 text-white",FATAL:"bg-red-700 text-white"},J=()=>{if(b==="all")return 0;const i=Date.now();if(b==="1h")return i-36e5;if(b==="today"){const w=new Date;return w.setHours(0,0,0,0),w.getTime()}if(b==="yesterday"){const w=new Date;return w.setDate(w.getDate()-1),w.setHours(0,0,0,0),w.getTime()}return 0},L=((c==null?void 0:c.data)||[]).filter(i=>{var M,S;if(x!=="ALL"&&i.level!==x||y&&!((M=i.deviceId)!=null&&M.toLowerCase().includes(y.toLowerCase()))&&!((S=i.message)!=null&&S.toLowerCase().includes(y.toLowerCase())))return!1;const w=J();return!(w&&new Date(i.timestamp).getTime()<w)});o.useEffect(()=>{r(20),f(null)},[x,(q=c==null?void 0:c.data)==null?void 0:q.length,y,b]),o.useEffect(()=>{const i=W.current;if(!i||D>=L.length)return;const w=new IntersectionObserver(M=>{var S;(S=M[0])!=null&&S.isIntersecting&&r(a=>Math.min(a+20,L.length))},{rootMargin:"120px"});return w.observe(i),()=>w.disconnect()},[L.length,D]),o.useEffect(()=>{const i=()=>P(window.scrollY>400);return window.addEventListener("scroll",i,{passive:!0}),()=>window.removeEventListener("scroll",i)},[]);const G=()=>{n(!1)},X=()=>window.scrollTo({top:0,behavior:"smooth"});return d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"hidden md:flex justify-center p-12",children:e.jsx(pe,{className:"animate-spin"})}),e.jsx("div",{className:"md:hidden space-y-2",children:Array.from({length:6}).map((i,w)=>e.jsx("div",{className:"h-14 rounded-lg bg-slate-100 dark:bg-dark-700 animate-pulse"},`log-skel-${w}`))})]}):e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-2xl font-display font-bold text-slate-900 dark:text-slate-100",children:t("devices.logs")}),e.jsx("p",{className:"hidden md:block text-slate-500 dark:text-slate-400 mt-1",children:t("devices.logsSubtitle")})]}),e.jsxs("button",{className:"hidden md:flex btn-primary items-center gap-2",onClick:()=>n(!0),children:[e.jsx(Ae,{className:"w-4 h-4"}),t("mdm.logManagement.onDemandFetch")]})]}),e.jsxs("div",{className:"md:hidden space-y-2.5",children:[e.jsx("div",{className:"flex gap-1.5 overflow-x-auto scrollbar-hide snap-x pb-1",children:B.map(i=>{var S,a;const w=i==="ALL"?((S=c==null?void 0:c.data)==null?void 0:S.length)||0:((a=c==null?void 0:c.data)==null?void 0:a.filter(N=>N.level===i).length)||0,M=x===i;return e.jsxs("button",{onClick:()=>j(i),className:`shrink-0 snap-start min-h-9 px-3 rounded-full text-xs font-bold flex items-center gap-1.5 transition-all active:scale-95 ${M?"bg-primary-600 text-white shadow-sm":"bg-white dark:bg-dark-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-dark-700"}`,children:[e.jsx("span",{children:i}),e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${M?"bg-white/20":"bg-slate-100 dark:bg-dark-600"}`,children:w})]},i)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{type:"text",value:y,onChange:i=>O(i.target.value),placeholder:t("mdm.searchDevices"),className:"w-full min-h-9 pl-8 pr-3 text-xs rounded-lg border border-slate-200 dark:border-dark-700 bg-white dark:bg-dark-800 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("select",{value:b,onChange:i=>C(i.target.value),className:"min-h-9 px-2.5 text-xs rounded-lg border border-slate-200 dark:border-dark-700 bg-white dark:bg-dark-800 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:t("time.all")||"å…¨éƒ¨"}),e.jsx("option",{value:"1h",children:t("time.last1h")}),e.jsx("option",{value:"today",children:t("time.today")||"ä»Šå¤©"}),e.jsx("option",{value:"yesterday",children:t("time.yesterday")||"æ˜¨å¤©"})]})]})]}),e.jsx("div",{className:"hidden md:grid md:grid-cols-5 gap-4",children:B.map(i=>{var S,a;const w=i==="ALL"?((S=c==null?void 0:c.data)==null?void 0:S.length)||0:((a=c==null?void 0:c.data)==null?void 0:a.filter(N=>N.level===i).length)||0,M={ALL:"bg-blue-500/10 text-blue-600",ERROR:"bg-red-500/10 text-red-600 border-red-200 dark:border-red-900",WARN:"bg-amber-500/10 text-amber-600 border-amber-200 dark:border-amber-900",INFO:"bg-green-500/10 text-green-600",DEBUG:"bg-slate-500/10 text-slate-600"};return e.jsxs("button",{onClick:()=>j(i),className:`p-4 rounded-xl border-2 transition-all active:scale-95 ${x===i?"border-primary-500 bg-primary-50 dark:bg-primary-950/20":`bg-white dark:bg-dark-800 border-transparent md:border-slate-100 md:dark:border-dark-700 ${M[i].split(" ").filter(N=>N.startsWith("border-")).join(" ")}`}`,children:[e.jsx("div",{className:`text-2xl font-bold rounded-lg ${M[i]}`,children:w}),e.jsx("div",{className:"text-sm text-slate-500 mt-1",children:i})]},i)})}),e.jsxs("div",{className:"glass-panel overflow-hidden md:p-0 p-0 bg-transparent md:bg-white dark:bg-transparent dark:md:bg-dark-800 shadow-none md:shadow-sm border-none md:border-solid",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-dark-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:t("common.time")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:t("mdm.deviceId")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:t("mdm.logManagement.level")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:t("mdm.logManagement.message")})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-dark-700",children:L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 dark:bg-dark-700 rounded-full flex items-center justify-center mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-slate-400"})}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:t("mdm.noLogs")}),e.jsx("p",{className:"text-sm text-slate-400 dark:text-slate-500 mt-1",children:t("mdm.logManagement.adjustFiltersHint")})]})})}):L.slice(0,50).map((i,w)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-dark-700/30",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-mono text-slate-500",children:new Date(i.timestamp).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono text-primary-600",children:i.deviceId}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${i.level==="ERROR"?"bg-red-500 text-white":i.level==="WARN"?"bg-amber-500 text-white":i.level==="INFO"?"bg-green-500 text-white":"bg-slate-500 text-white"}`,children:i.level})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400 max-w-md truncate",children:i.message})]},w))})]})}),e.jsxs("div",{className:"md:hidden space-y-1.5",children:[L.length===0?e.jsx("div",{className:"py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 bg-slate-100 dark:bg-dark-700 rounded-full flex items-center justify-center mb-3",children:e.jsx(ae,{className:"w-7 h-7 text-slate-400"})}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:t("mdm.noLogs")})]})}):L.slice(0,D).map((i,w)=>{const M=m===w;return e.jsxs("button",{type:"button",onClick:()=>f(M?null:w),className:"w-full text-left flex rounded-lg bg-white dark:bg-dark-800 border border-slate-200 dark:border-dark-700 overflow-hidden active:bg-slate-50 dark:active:bg-dark-700 transition-colors",children:[e.jsx("div",{className:`w-1 shrink-0 ${re[i.level]||"bg-slate-300"}`}),e.jsxs("div",{className:"flex-1 min-w-0 px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold leading-none ${K[i.level]||"bg-slate-500 text-white"}`,children:i.level}),e.jsx("span",{className:"font-mono text-xs font-semibold text-primary-600 dark:text-primary-400 truncate",children:i.deviceId}),e.jsx("span",{className:"ml-auto text-[10px] text-slate-400 font-mono shrink-0 tabular-nums",children:new Date(i.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:`mt-1 text-xs text-slate-600 dark:text-slate-400 ${M?"":"line-clamp-1"}`,children:i.message}),M&&e.jsxs("p",{className:"mt-1.5 text-[10px] text-slate-400 font-mono flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),new Date(i.timestamp).toLocaleString()]})]})]},w)}),L.length>D&&e.jsxs("div",{ref:W,className:"w-full py-3 text-center text-xs text-slate-500 dark:text-slate-400",children:[e.jsx(pe,{className:"w-4 h-4 animate-spin inline-block mr-1.5"}),t("common.loadMore")," (",L.length-D,")"]})]})]}),e.jsx(Z,{children:u&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-[70]",onClick:()=>n(!1)}),e.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 flex items-end md:items-center justify-center z-[80] p-0 md:p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-t-2xl md:rounded-2xl p-6 max-w-lg w-full shadow-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-blue-500"}),t("mdm.logManagement.onDemandFetch")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.deviceId")}),e.jsx("input",{type:"text",value:h,onChange:i=>p(i.target.value),className:"input-field mt-1",placeholder:t("devices.enterDeviceIdHint")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.logManagement.startTime")}),e.jsx("input",{type:"datetime-local",value:V.startTime,onChange:i=>H({...V,startTime:i.target.value}),className:"input-field mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.logManagement.endTime")}),e.jsx("input",{type:"datetime-local",value:V.endTime,onChange:i=>H({...V,endTime:i.target.value}),className:"input-field mt-1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:t("mdm.logManagement.maxLines")}),e.jsx("input",{type:"number",value:V.maxLines,onChange:i=>H({...V,maxLines:+i.target.value}),className:"input-field mt-1"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{className:"flex-1 btn-secondary",onClick:()=>n(!1),children:t("common.cancel")}),e.jsx("button",{className:"flex-1 btn-primary",onClick:G,children:t("mdm.logManagement.fetch")})]})]})})]})}),e.jsx("button",{className:"md:hidden fixed z-[80] right-6 w-14 h-14 bg-primary-600 hover:bg-primary-700 text-white rounded-full flex items-center justify-center shadow-lg shadow-primary-500/30 active:scale-95 transition-transform",style:Fe,"aria-label":t("mdm.logManagement.onDemandFetch"),onClick:()=>n(!0),children:e.jsx(Ae,{className:"w-6 h-6"})}),e.jsx(Z,{children:v&&e.jsx(k.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},type:"button",onClick:X,className:"md:hidden fixed z-[79] right-6 w-10 h-10 bg-white dark:bg-dark-700 border border-slate-200 dark:border-dark-600 rounded-full flex items-center justify-center shadow-lg active:scale-95 transition-transform",style:{bottom:"calc(160px + env(safe-area-inset-bottom, 0px))"},"aria-label":"Scroll to top",children:e.jsx(Ee,{className:"w-5 h-5 text-slate-600 dark:text-slate-300 rotate-180"})})})]})},oe=[{path:"/devices",labelKey:"devices.dashboard",icon:Pt},{path:"/devices/list",labelKey:"devices.deviceList",icon:ve},{path:"/devices/health",labelKey:"devices.health",icon:se},{path:"/devices/firmware",labelKey:"devices.firmware",icon:$e},{path:"/devices/remote",labelKey:"devices.remote",icon:Re},{path:"/devices/logs",labelKey:"devices.logs",icon:Ne},{path:"/devices/maintenance",labelKey:"devices.maintenance",icon:me}];function Gs(){const{t}=z(),c=Qt(),d=Le(),[x,j]=o.useState(!1),h=["/devices","/devices/list","/devices/health","/devices/remote"];oe.filter(r=>h.includes(r.path));const p=oe.filter(r=>!h.includes(r.path)),u=r=>{switch(r){case"add":d("/devices/list?action=add_device");break;case"reboot_all":d("/devices/list?action=reboot_all");break;case"sync":d("/devices/logs");break;case"activity":d("/devices/health");break;case"radar":d("/devices");break;case"settings":d("/devices/remote");break}},n=[...oe].sort((r,m)=>m.path.length-r.path.length).find(r=>c.pathname===r.path||c.pathname.startsWith(`${r.path}/`))||oe[0];p.some(r=>c.pathname===r.path||c.pathname.startsWith(`${r.path}/`));const D=c.pathname==="/devices/firmware";return o.useEffect(()=>{j(!1)},[c.pathname]),e.jsxs("div",{className:"h-full flex flex-col",children:[!D&&e.jsxs("div",{className:"flex-shrink-0 mx-6 mt-6 mb-3 hidden md:flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400",children:[e.jsx("button",{type:"button",onClick:()=>d("/devices"),className:"hover:text-primary-500 transition-colors",children:t("common.deviceManagement")}),e.jsx(gt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-slate-900 dark:text-slate-100 font-medium",children:t(n.labelKey)})]}),e.jsx("div",{className:"md:hidden sticky top-0 z-30 px-4 py-2.5 bg-slate-50/95 dark:bg-dark-900/95 backdrop-blur-md border-b border-slate-200/60 dark:border-dark-700/60 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsxs("button",{type:"button",onClick:()=>j(!x),className:"w-full min-h-11 flex items-center justify-between gap-2 px-3.5 rounded-xl border border-slate-200 dark:border-dark-700 bg-white dark:bg-dark-800 active:scale-[0.98] transition-transform shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsx(n.icon,{className:"w-4 h-4 text-primary-500 shrink-0"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 truncate",children:t(n.labelKey)})]}),e.jsx(Ee,{className:`w-4 h-4 text-slate-400 shrink-0 transition-transform duration-200 ${x?"rotate-180":""}`})]}),e.jsx(Z,{children:x&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[59]",onClick:()=>j(!1)}),e.jsx(k.div,{initial:{opacity:0,y:-8,scale:.96},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-8,scale:.96},transition:{duration:.18,ease:[.16,1,.3,1]},className:"absolute left-0 right-0 top-[calc(100%+6px)] z-[60] rounded-xl border border-slate-200 dark:border-dark-700 bg-white dark:bg-dark-800 shadow-2xl overflow-hidden",children:oe.map(r=>{const m=r===n;return e.jsxs(ot,{to:r.path,end:r.path==="/devices",onClick:()=>j(!1),className:()=>`flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors border-b border-slate-100 dark:border-dark-700 last:border-b-0 ${m?"bg-primary-50 dark:bg-primary-500/10 text-primary-600 dark:text-primary-400":"text-slate-700 dark:text-slate-300 active:bg-slate-50 dark:active:bg-dark-700"}`,children:[e.jsx(r.icon,{className:`w-4 h-4 shrink-0 ${m?"text-primary-500":"text-slate-400"}`}),e.jsx("span",{className:"flex-1",children:t(r.labelKey)}),m&&e.jsx(Ye,{className:"w-4 h-4 shrink-0 text-primary-500"})]},`dropdown-${r.path}`)})})]})})]}),e.jsx("button",{type:"button",onClick:()=>d("/devices/list"),className:"w-11 min-h-11 rounded-xl border border-slate-200 dark:border-dark-700 bg-white dark:bg-dark-800 flex items-center justify-center active:scale-95 transition-transform shadow-sm",title:t("devices.deviceList"),children:e.jsx(ve,{className:"w-4 h-4 text-blue-500"})}),e.jsx("button",{type:"button",onClick:()=>d("/devices/health"),className:"w-11 min-h-11 rounded-xl border border-slate-200 dark:border-dark-700 bg-white dark:bg-dark-800 flex items-center justify-center active:scale-95 transition-transform shadow-sm",title:t("devices.health"),children:e.jsx(se,{className:"w-4 h-4 text-green-500"})})]})}),e.jsx("div",{className:"hidden md:block sticky top-0 z-30 px-4 py-3 bg-white/80 dark:bg-dark-900/80 backdrop-blur-md border-b border-slate-200/60 dark:border-dark-700/60 mb-2",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide snap-x touch-pan-x py-1",children:oe.map(r=>e.jsxs(ot,{to:r.path,end:r.path==="/devices",className:({isActive:m})=>`shrink-0 snap-start min-h-11 flex items-center gap-2 px-4 rounded-full transition-all duration-200 text-sm font-semibold whitespace-nowrap active:scale-95 shadow-sm border ${m?"bg-primary-600 text-white border-primary-500 shadow-primary-200 dark:shadow-none ring-2 ring-primary-500/20":"bg-slate-100 dark:bg-dark-800 text-slate-600 dark:text-slate-400 border-slate-200 dark:border-dark-700 hover:bg-slate-200 dark:hover:bg-dark-700"}`,children:[e.jsx(r.icon,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:t(r.labelKey)})]},r.path))})}),e.jsx(bs,{onAction:u}),e.jsx("main",{className:"flex-1 overflow-auto overflow-x-hidden px-4 lg:px-6 pb-24 lg:pb-6 pt-4",children:e.jsxs(Zt,{children:[e.jsx(de,{index:!0,element:e.jsx(vs,{})}),e.jsx(de,{path:"list",element:e.jsx(Ns,{})}),e.jsx(de,{path:"health",element:e.jsx(ys,{})}),e.jsx(de,{path:"firmware",element:e.jsx(ks,{})}),e.jsx(de,{path:"remote",element:e.jsx(ws,{})}),e.jsx(de,{path:"logs",element:e.jsx(Ds,{})}),e.jsx(de,{path:"maintenance",element:e.jsx(Cs,{})})]})})]})}export{Gs as default};
